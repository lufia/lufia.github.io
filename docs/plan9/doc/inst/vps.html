<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<script>
document.createElement('article')
document.createElement('aside')
document.createElement('footer')
document.createElement('header')
document.createElement('nav')
document.createElement('section')
</script>
<style>
article, aside, footer, header, nav, section { display: block }
</style>
<title>Plan 9: さくらVPSにPlan 9をインストール</title>
<script src="/lib/jquery.js"></script>
<script src="/lib/decor.js"></script>
<script src="/plan9/lib/complex.js"></script>
<link rel="stylesheet" type="text/css" href="/plan9/lib/u.css">
<meta name="author" content="http://www.hatena.ne.jp/lufiabb/">
</head>
<body>
<header>
		<h1><a href="/plan9/">Plan 9</a></h1>
</header>
<nav>
	<section>
		<h1>メニュー</h1>
		<ul>
		<li><a href="/plan9/doc/inst/">インストール</a></li>
		<li><a href="/plan9/doc/guide/">システムの使い方</a></li>
		<li><a href="/plan9/doc/devel/">プログラミング</a></li>
		<li><a href="/plan9/doc/adm/">システム管理</a></li>
		<li><a href="/plan9/man/">自作ツール集</a></li>
		</ul>
	</section>
</nav>
<article>
	<section>
		<h1>さくらVPSにPlan 9をインストール</h1>
		<p class="revision">2014年2月22日作成</p>
		<p>さくらVPSにベル研版Plan 9をインストールしました。
		最近のさくらVPSはISOインストールが可能になっていますので、
		それを使っています。</p>
		<section>
			<h2>ISOイメージの転送</h2>
			<p>まずはさくらVPSコントロールパネルから、
			ISOアップロード用のsftpアカウントを作る必要があります。
			その後、Plan 9公式配布物のISOイメージをダウンロードして、
			(bz2を解凍してから)さくらVPSにアップロードします。</p>
			<p>アップロード用のアカウントは1日で自動的に無効化されるようです。
			また、アカウントを削除するとアップロードしたISOイメージも消えてまうので、
			やる気のあるときにアップロードすることをおすすめします。</p>
		</section>
		<section>
			<h2>Plan 9のインストール</h2>
			<p>ISOイメージのアップロードが終わったら、
			コントロールパネルのOS再インストールメニューから、
			ISOイメージからインストールを選択します。</p>
			<p>次に、インストール内容確認のところで、virtio有効にチェックが入っているので、
			これを無効にしてから、インストールを開始します。
			(virtioが有効になっていると/dev/sdC0が見つかりませんでした)</p>
		</section>
		<section>
			<h2>インストール時の設定</h2>
			<p>以下のようにインストーラからの質問へ答えました。</p>
			<table>
			<tr><th>メニュー</th><th>設定値</th></tr>
			<tr><td>dmaon</td><td>yes</td></tr>
			<tr><td>mouseport</td><td>ps2</td></tr>
			<tr><td>vgasize</td><td>1024x768x32</td></tr>
			<tr><td>monitor</td><td>xga</td></tr>
			</table>
			<p>この後、しばらくするとrioが立ち上がってきます。
			ここから先はメニューに答えるだけです。</p>
			<section>
				<h3>configfs</h3>
				<p>fossil+ventiを選びました。</p>
			</section>
			<section>
				<h3>partdisk, prepdisk</h3>
				<p>すでにLinux用のパーティションが存在しましたので、
				いちど全部を削除してから、作り直しが必要でした。
				全部削除してw, qでメニューを抜ければ、
				おすすめのパーティションが切られます。</p>
			</section>
			<section>
				<h3>fmtfossil</h3>
				<p>インストーラが不要だと判断した場合はスキップされますが、
				必ず実行しておきましょう。</p>
			</section>
			<section>
				<h3>fmtventi</h3>
				<p>fmtfossilと同様に、必ずフォーマットしておきましょう。</p>
			</section>
			<section>
				<h3>copydist</h3>
				<p>ファイルのコピーが始まります。
				今回インストールしたときは10分もかかっていない気がします。</p>
			</section>
			<section>
				<h3>bootstrap</h3>
				<p>Enable boot methodを聞かれたらplan9を選びます。
				<a href="http://www.tsubame2.org/2010/10/vps-plan-9_11.html">さくらVPSにまるまるPlan 9をインストール</a>のように、
				ctl+dで抜ける方法を使っても大丈夫です。</p>
			</section>
			<section>
				<h3>finish</h3>
				<p>インストールが一通り終わったら、再起動するように促されますが、
				その前に、plan9.iniへ行の追加が必要です。
				適当にウインドウを開いて、</p>
				<pre>% mount /srv/dos /n/9fat /dev/sdC0/9fat
% cat /n/9fat/plan9.ini
# 無ければ、以下の2行を追加
*nomp=1
console=0 b115200 l8 pn s1
% unmount /n/9fat</pre>
			</section>
		</section>
		<section>
			<h2>再起動</h2>
			<p>さくらVPSのコントロールパネルから再起動したとき、
			GRUBから先に進まない状態になってしまっていたなら、
			もういちどISOからインストールを選びます。
			そうするとCDからブートしているけれど上記でインストールした
			環境を操作できるようになりますので、
			glendaでログインして以下のコマンドを実行しましょう。</p>
			<pre>% disk/mbr -m /386/mbr /dev/sdC0/data</pre>
			<p>最初にventiへ書き込みをしているようで、とても重いです。
			少し待てば落ち着きます。</p>
		</section>
		<section>
			<h2>NICを認識させる</h2>
			<p>インストール直後は、</p>
			<pre>igbe: p-&gt;cls 0x0, setting to 0x10
igbe: bad EEPROM checksum - 0x535E</pre>
			<p>のようなエラーでNICが認識できていませんでしたので、<a href="http://d.hatena.ne.jp/oraccha/20100928/1285683705">さくらVPSでPlan 9</a>を参考に
			/sys/src/9/pc/etherigbe.c:at93c46rを以下のように変更2しました。</p>
			<pre>snprint(rop, sizeof(rop), &quot;CcS :%dDCc;&quot;, bits+3);
// Ccを追加</pre>
			<p>あとはコンパイルして再起動でNICを認識できます。</p>
			<pre>% cd /sys/src/9/pc
% mk 'CONF=pcf'
% 9fat:
% mv 9pcf /n/9fat/9pcf
% mk 'CONF=pcf' nuke
% fshalt</pre>
		</section>
	</section>
</article>
<aside>
	<section>
		<h1>関連情報</h1>
		<ul>
		<li><a href="virtio.html">VirtIOを使う</a></li>
		<li><a href="sizka.html">Sizka BASICへのインストール</a></li>
		</ul>
	</section>
</aside>
<footer>
	<p>見れない、表示がおかしい場合は、動作環境を添えて<a href="mailto:webmaster@lufia.org">webmaster@lufia.org</a>まで連絡ください。</p>
</footer>
</body>
</html>
