<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<script>
document.createElement('article')
document.createElement('aside')
document.createElement('footer')
document.createElement('header')
document.createElement('nav')
document.createElement('section')
</script>
<style>
article, aside, footer, header, nav, section { display: block }
</style>
<title>Plan 9: Plan 9のアップデート</title>
<script src="/lib/jquery.js"></script>
<script src="/lib/decor.js"></script>
<script src="/plan9/lib/complex.js"></script>
<link rel="stylesheet" type="text/css" href="/plan9/lib/u.css">
<meta name="author" content="http://www.hatena.ne.jp/lufiabb/">
</head>
<body>
<header>
		<h1><a href="/plan9/">Plan 9</a></h1>
</header>
<nav>
	<section>
		<h1>メニュー</h1>
		<ul>
		<li><a href="/plan9/doc/inst/">インストール</a></li>
		<li><a href="/plan9/doc/guide/">システムの使い方</a></li>
		<li><a href="/plan9/doc/devel/">プログラミング</a></li>
		<li><a href="/plan9/doc/adm/">システム管理</a></li>
		<li><a href="/plan9/man/">自作ツール集</a></li>
		</ul>
	</section>
</nav>
<article>
	<section>
		<h1>Plan 9のアップデート</h1>
		<p class="revision">2011年12月3日更新</p>
		<p>似たような記事が<a href="../inst/fs.html">ファイルサーバのインストール</a>
		にもありますが、こちらはPlan 9環境全体のアップデート。
		あちらはken fsソースそのもののアップデートになります。</p>
		<p>fs環境で使っていると、/dist/replica/networkが
		うまく動いてくれません。fossilもkfsも無いからね。
		なので、replicaするには自分で設定ファイルを作ります。</p>
		<pre>fs: create /dist/replica/inst sys sys 775</pre>
		<p>以下が/dist/replica/instの内容。</p>
		<pre>#!/bin/rc

# Generic plan9 installation template.
# Assumes that distribution CD or sources
# is mounted at /n/dist, and should be installed
# to /n/inst.

s=/n/dist/dist/replica
serverroot=/n/dist
serverlog=$s/plan9.log
serverproto=$s/plan9.proto
fn servermount { status='' } 
fn serverupdate { status='' }

fn clientmount { status='' }
c=/n/inst/dist/replica
clientroot=/n/inst
clientproto=$c/plan9.proto
clientdb=$c/client/plan9.db
clientexclude=(dist/replica/client)
clientlog=$c/client/plan9.log

applyopt=(-t -u -T$c/client/plan9.time)</pre>
		<p>実際にreplicaするときは以下のように。
		ファイルサーバ側でallowするのを忘れないように。</p>
		<pre>% mount -c /srv/boot /n/inst
% 9fs sources
% bind /n/sources/plan9 /n/dist
fs: allow
% replica/pull -v /dist/replica/inst</pre>
		<p>以上でアップデートが行われます。
		とても時間がかかるので、ゲームでも遊びながら待ちましょう。</p>
		<p>pullに-vオプションを与えると詳細が表示されます。
		このとき出てくる文字は、</p>
		<dl>
		<dt>a</dt>
		<dd>追加</dd>
		<dt>c</dt>
		<dd>ファイル内容の変更</dd>
		<dt>d</dt>
		<dd>ファイルの削除</dd>
		<dt>m</dt>
		<dd>メタデータ(パーミッションとか)の変更</dd>
		<dt>!</dt>
		<dd>競合しているので変更しない</dd>
		</dl>
		<p>のようになっています。
		競合した場合、サーバのファイルで更新したいときは、
		全体のアップデートが終わった後で以下のように書きます。</p>
		<pre>% replica/pull -s sys/src/9/pcflop /dist/replica/inst</pre>
		<p>これでしばらく待つと、/sys/src/9/pcflopがサーバのもので更新されます。
		競合が複数ある場合は、-sオプションを必要なだけ使って指示します。</p>
		<pre>% replica/pull -s file1 -s file2 /dist/replica/inst</pre>
		<p>終わったら後始末。</p>
		<pre>fs: disallow
% unmount /n/dist
% unmount /n/sources
% rm /srv/sources
% unmount /n/inst</pre>
	</section>
</article>
<aside>
	<section>
		<h1>参考ページ</h1>
		<ul>
		<li><a href="http://plan9.aichi-u.ac.jp/replica/">配布ファイルの更新</a></li>
		</ul>
	</section>
</aside>
<footer>
	<p>見れない、表示がおかしい場合は、動作環境を添えて<a href="mailto:webmaster@lufia.org">webmaster@lufia.org</a>まで連絡ください。</p>
</footer>
</body>
</html>
