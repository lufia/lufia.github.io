        <!DOCTYPE HTML>
        <html>
            <head>
                <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
                <link rel="stylesheet" type="text/css" href="../style.css"/>
            </head>
            <body>
                
                
                                    <h1>syscall 53問題踏んだ</h1>
                    <p>ふとした気の緩みで、大きく時間が取れるまで待っていたnsec()問題を踏んでしまった。
nsec()問題というのは、5月の中旬ごろに発生したnsec()がライブラリから
システムコールに変更されたことによって単純にアップデートしただけでは</p>

<pre><code>bad sys call number 53
</code></pre>

<p>というエラーでコマンド類が動かなくなる現象のことを言う。</p>

<p>カーネルのソースだけアップデートしようと計画していたのだけれど、</p>

<pre><code>% replica/pull -s sys/src/9 /dist/replica/network
</code></pre>

<p>を実行してしまって、コマンド類も全部アップデートされた。
結果、新しいバイナリはnsec()システムコールを期待するけど、
今回はまだカーネルが古く、nsec()がエラーになる。
なのでそのままでは新しいカーネルのコンパイルさえできない。</p>

<p>解決方法としてはいくつか9fansに挙がっていたけど、
replicaは古いバイナリを_からはじまる名前で残しているので、
こっちを使って新しいカーネルをコンパイルするのが簡単だと思う。</p>

<pre><code>% for(cmd in mk ar date ramfs)
&gt; bind /bin/_$cmd /bin/$cmd
% ramfs
% cd /sys/src/9/pc
% mk 'CONF=pccpuf'
(コンパイルが終わったら)
% _dossrv
% mount -c /srv/dos /n/9fat /dev/sdC0/9fat
% mv 9pccpuf /n/9fat/
</code></pre>

<p>これについて、replicaでバイナリもアップデートされるのが問題だ、とか、
アップデート時にカーネルも含めて依存関係を解決すべきだ、とか
9fansで話があったような気がする。</p>
                
                
                
                
                
                
                                <div id="footer">
                <span id="timestamp"> June 21st, 2014 12:44am </span>
                                                      <span class="tag">plan9</span>
                                              </div>
            </body>
        </html>

        