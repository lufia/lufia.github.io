        <!DOCTYPE HTML>
        <html>
            <head>
                <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
                <link rel="stylesheet" type="text/css" href="../style.css"/>
            </head>
            <body>
                
                
                                    <h1>Plan 9 on さくらVPSのI/Oが遅い</h1>
                    <h2>解決</h2>

<p>原因がどうにもわからないので9fansにポストしたところ、
最終的に、Plan 9のTCP実装が問題で、inパケットのMSSが大きすぎて
不審な動作をしていたらしい。</p>

<p>9legacyに<a href="http://9legacy.org/9legacy/patch/9-tcp-mss.diff">パッチがある</a>ので当てると解消する。</p>

<h2>オリジナル記事</h2>

<p>さくらVPSにインストールしたPlan 9(labs)は、Disk I/Oが遅くて、
iostatsで</p>

<pre><code>iostats md5sum /386/9pcf
iostats cp /386/9pcf /tmp/9pcf
(md5sumするとキャッシュに乗るのでcpのReadは早い)
</code></pre>

<p>のように計測したところ、Read性能が100KB程度しか出ていない。
この現象について、これまで調べたところをまとめた。
以下でPlan 9と書いたものはLabs版(全部デフォルト)をあらわす。
pbslba等、変更している場合はPlan 9(pbslba)等と書く。</p>

<table><thead><tr><th>Host</th>
  <th>OS</th>
  <th>Filesystem</th>
  <th>Read</th>
  <th>Write</th>
</tr></thead><tbody><tr><td>さくらVPS</td>
  <td>Plan 9</td>
  <td>fossil</td>
  <td>100KB</td>
  <td>2.5MB</td>
</tr><tr><td>さくらVPS</td>
  <td>Plan 9</td>
  <td>vacfs</td>
  <td>100KB</td>
  <td>2.5MB</td>
</tr><tr><td>さくらVPS</td>
  <td>Plan 9</td>
  <td>ramfs</td>
  <td>8MB?</td>
  <td>2.5MB</td>
</tr><tr><td>VMware</td>
  <td>Plan 9</td>
  <td>fossil</td>
  <td>2.5MB</td>
  <td>2.5MB</td>
</tr><tr><td>さくらVPS</td>
  <td>9front</td>
  <td>cwfs</td>
  <td>2.5MB</td>
  <td>2.5MB</td>
</tr><tr><td>さくらVPS</td>
  <td>Plan 9(9pccpuf)</td>
  <td>fossil</td>
  <td>100KB</td>
  <td>2.5MB</td>
</tr><tr><td>さくらVPS</td>
  <td>Plan 9(virtio)</td>
  <td>fossil</td>
  <td>100KB</td>
  <td>2.5MB</td>
</tr><tr><td>さくらVPS</td>
  <td>Plan 9(pbslba)</td>
  <td>fossil</td>
  <td>100KB</td>
  <td>2.5MB</td>
</tr><tr><td>さくらVPS</td>
  <td>Plan 9(grub)</td>
  <td>fossil</td>
  <td>100KB</td>
  <td>2.5MB</td>
</tr></tbody></table><p>最後の&quot;Plan 9(grub)&ldquo;は、Plan 9のmbrを使わずに、
grubから以下のようにしてブートした。</p>

<pre><code>grub&gt; root (hd0,0)
grub&gt; chainloader +1
grub&gt; boot
</code></pre>

<p>MBR、PBS、カーネルローダ、カーネル、ドライバ、ファイルシステムの
一通り差し替えてみたけれど解決しないので、
じっくり調べないとだめかもしれない。</p>
                
                
                
                
                
                
                                <div id="footer">
                <span id="timestamp"> February 16th, 2015 11:17pm </span>
                                                      <span class="tag">plan9</span>
                                              </div>
            </body>
        </html>

        