<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Plan 9: Plan 9のアップデート</title><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="author" content="http://www.hatena.ne.jp/lufiabb/"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/1b15737708df434c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1b15737708df434c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-c2e8b39087850489.js" defer=""></script><script src="/_next/static/chunks/main-7715c9ce3e92f40f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e84d751e7e95936.js" defer=""></script><script src="/_next/static/chunks/245-02c6405e66663b10.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...slug%5D%5D-663c09fbf665935a.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_buildManifest.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_ssgManifest.js" defer=""></script></head><body><div id="__next">
<nav>
	<h1>メニュー</h1>
	<ul>
	<li><a href="/plan9/index.html"><a>Plan 9</a></a></li>
	<li><a href="/plan9/doc/inst/index.html"><a>インストール</a></a></li>
	<li><a href="/plan9/doc/guide/index.html"><a>システムの使い方</a></a></li>
	<li><a href="/plan9/doc/devel/index.html"><a>プログラミング</a></a></li>
	<li><a href="/plan9/doc/adm/index.html"><a>システム管理</a></a></li>
	<li><a href="/plan9/man/index.html"><a>自作ツール集</a></a></li>
	</ul>
</nav>
<main>
	<p class="revision">2011年12月3日更新</p>
	<section>
		<h1>Plan 9のアップデート</h1>
		<p>似たような記事が<a href="/plan9/doc/inst/fs.html"><a>ファイルサーバのインストール</a></a>
		にもありますが、こちらはPlan 9環境全体のアップデート。
		あちらはken fsソースそのもののアップデートになります。</p>
		<p>fs環境で使っていると、<strong>/dist/replica/network</strong>が
		うまく動いてくれません。fossilもkfsも無いからね。
		なので、replicaするには自分で設定ファイルを作ります。</p>
		<pre><code class="console">fs: create /dist/replica/inst sys sys 775</code></pre>
		<p>以下が<strong>/dist/replica/inst</strong>の内容。</p>
		<pre><code class="sh">#!/bin/rc

# Generic plan9 installation template.
# Assumes that distribution CD or sources
# is mounted at /n/dist, and should be installed
# to /n/inst.

s=/n/dist/dist/replica
serverroot=/n/dist
serverlog=$s/plan9.log
serverproto=$s/plan9.proto
fn servermount { status=&#x27;&#x27; } 
fn serverupdate { status=&#x27;&#x27; }

fn clientmount { status=&#x27;&#x27; }
c=/n/inst/dist/replica
clientroot=/n/inst
clientproto=$c/plan9.proto
clientdb=$c/client/plan9.db
clientexclude=(dist/replica/client)
clientlog=$c/client/plan9.log

applyopt=(-t -u -T$c/client/plan9.time)</code></pre>
		<p>実際にreplicaするときは以下のように。
		ファイルサーバ側でallowするのを忘れないように。</p>
		<pre><code class="console">% mount -c /srv/boot /n/inst
% 9fs sources
% bind /n/sources/plan9 /n/dist
fs: allow
% replica/pull -v /dist/replica/inst</code></pre>
		<p>以上でアップデートが行われます。
		とても時間がかかるので、ゲームでも遊びながら待ちましょう。</p>
		<p>pullに-vオプションを与えると詳細が表示されます。
		このとき出てくる文字は、</p>
		<dl>
		<div>
			<dt>a</dt>
			<dd>追加</dd>
		</div>
		<div>
			<dt>c</dt>
			<dd>ファイル内容の変更</dd>
		</div>
		<div>
			<dt>d</dt>
			<dd>ファイルの削除</dd>
		</div>
		<div>
			<dt>m</dt>
			<dd>メタデータ(パーミッションとか)の変更</dd>
		</div>
		<div>
			<dt>!</dt>
			<dd>競合しているので変更しない</dd>
		</div>
		</dl>
		<p>のようになっています。
		競合した場合、サーバのファイルで更新したいときは、
		全体のアップデートが終わった後で以下のように書きます。</p>
		<pre><code class="console">% replica/pull -s sys/src/9/pcflop /dist/replica/inst</code></pre>
		<p>これでしばらく待つと、/sys/src/9/pcflopがサーバのもので更新されます。
		競合が複数ある場合は、-sオプションを必要なだけ使って指示します。</p>
		<pre><code class="console">% replica/pull -s file1 -s file2 /dist/replica/inst</code></pre>
		<p>終わったら後始末。</p>
		<pre><code class="console">fs: disallow
% unmount /n/dist
% unmount /n/sources
% rm /srv/sources
% unmount /n/inst</code></pre>
	</section>
</main>
<aside>
	<h1>参考ページ</h1>
	<ul>
	<li><a href="http://p9.nyx.link/replica/">配布ファイルの更新</a></li>
	</ul>
</aside>
<footer>
	<p>見れない、表示がおかしい場合は、動作環境を添えて<a href="/plan9/doc/adm/mailto:webmaster@lufia.org"><a>webmaster@lufia.org</a></a>まで連絡ください。</p>
</footer>
</div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003c!doctype html\u003e\n\u003chtml lang=\"ja\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003ePlan 9: Plan 9のアップデート\u003c/title\u003e\n\u003cmeta name=\"viewport\" content=\"width=device-width,initial-scale=1\"\u003e\n\u003cmeta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cnav\u003e\n\t\u003ch1\u003eメニュー\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/index.html\"\u003ePlan 9\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/inst/index.html\"\u003eインストール\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/guide/index.html\"\u003eシステムの使い方\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/devel/index.html\"\u003eプログラミング\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/adm/index.html\"\u003eシステム管理\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/man/index.html\"\u003e自作ツール集\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/nav\u003e\n\u003cmain\u003e\n\t\u003cp class=\"revision\"\u003e2011年12月3日更新\u003c/p\u003e\n\t\u003csection\u003e\n\t\t\u003ch1\u003ePlan 9のアップデート\u003c/h1\u003e\n\t\t\u003cp\u003e似たような記事が\u003ca href=\"../inst/fs.html\"\u003eファイルサーバのインストール\u003c/a\u003e\n\t\tにもありますが、こちらはPlan 9環境全体のアップデート。\n\t\tあちらはken fsソースそのもののアップデートになります。\u003c/p\u003e\n\t\t\u003cp\u003efs環境で使っていると、\u003cstrong\u003e/dist/replica/network\u003c/strong\u003eが\n\t\tうまく動いてくれません。fossilもkfsも無いからね。\n\t\tなので、replicaするには自分で設定ファイルを作ります。\u003c/p\u003e\n\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003efs: create /dist/replica/inst sys sys 775\u003c/code\u003e\u003c/pre\u003e\n\t\t\u003cp\u003e以下が\u003cstrong\u003e/dist/replica/inst\u003c/strong\u003eの内容。\u003c/p\u003e\n\t\t\u003cpre\u003e\u003ccode class=\"sh\"\u003e#!/bin/rc\n\n# Generic plan9 installation template.\n# Assumes that distribution CD or sources\n# is mounted at /n/dist, and should be installed\n# to /n/inst.\n\ns=/n/dist/dist/replica\nserverroot=/n/dist\nserverlog=$s/plan9.log\nserverproto=$s/plan9.proto\nfn servermount { status='' } \nfn serverupdate { status='' }\n\nfn clientmount { status='' }\nc=/n/inst/dist/replica\nclientroot=/n/inst\nclientproto=$c/plan9.proto\nclientdb=$c/client/plan9.db\nclientexclude=(dist/replica/client)\nclientlog=$c/client/plan9.log\n\napplyopt=(-t -u -T$c/client/plan9.time)\u003c/code\u003e\u003c/pre\u003e\n\t\t\u003cp\u003e実際にreplicaするときは以下のように。\n\t\tファイルサーバ側でallowするのを忘れないように。\u003c/p\u003e\n\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% mount -c /srv/boot /n/inst\n% 9fs sources\n% bind /n/sources/plan9 /n/dist\nfs: allow\n% replica/pull -v /dist/replica/inst\u003c/code\u003e\u003c/pre\u003e\n\t\t\u003cp\u003e以上でアップデートが行われます。\n\t\tとても時間がかかるので、ゲームでも遊びながら待ちましょう。\u003c/p\u003e\n\t\t\u003cp\u003epullに-vオプションを与えると詳細が表示されます。\n\t\tこのとき出てくる文字は、\u003c/p\u003e\n\t\t\u003cdl\u003e\n\t\t\u003cdiv\u003e\n\t\t\t\u003cdt\u003ea\u003c/dt\u003e\n\t\t\t\u003cdd\u003e追加\u003c/dd\u003e\n\t\t\u003c/div\u003e\n\t\t\u003cdiv\u003e\n\t\t\t\u003cdt\u003ec\u003c/dt\u003e\n\t\t\t\u003cdd\u003eファイル内容の変更\u003c/dd\u003e\n\t\t\u003c/div\u003e\n\t\t\u003cdiv\u003e\n\t\t\t\u003cdt\u003ed\u003c/dt\u003e\n\t\t\t\u003cdd\u003eファイルの削除\u003c/dd\u003e\n\t\t\u003c/div\u003e\n\t\t\u003cdiv\u003e\n\t\t\t\u003cdt\u003em\u003c/dt\u003e\n\t\t\t\u003cdd\u003eメタデータ(パーミッションとか)の変更\u003c/dd\u003e\n\t\t\u003c/div\u003e\n\t\t\u003cdiv\u003e\n\t\t\t\u003cdt\u003e!\u003c/dt\u003e\n\t\t\t\u003cdd\u003e競合しているので変更しない\u003c/dd\u003e\n\t\t\u003c/div\u003e\n\t\t\u003c/dl\u003e\n\t\t\u003cp\u003eのようになっています。\n\t\t競合した場合、サーバのファイルで更新したいときは、\n\t\t全体のアップデートが終わった後で以下のように書きます。\u003c/p\u003e\n\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% replica/pull -s sys/src/9/pcflop /dist/replica/inst\u003c/code\u003e\u003c/pre\u003e\n\t\t\u003cp\u003eこれでしばらく待つと、/sys/src/9/pcflopがサーバのもので更新されます。\n\t\t競合が複数ある場合は、-sオプションを必要なだけ使って指示します。\u003c/p\u003e\n\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% replica/pull -s file1 -s file2 /dist/replica/inst\u003c/code\u003e\u003c/pre\u003e\n\t\t\u003cp\u003e終わったら後始末。\u003c/p\u003e\n\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003efs: disallow\n% unmount /n/dist\n% unmount /n/sources\n% rm /srv/sources\n% unmount /n/inst\u003c/code\u003e\u003c/pre\u003e\n\t\u003c/section\u003e\n\u003c/main\u003e\n\u003caside\u003e\n\t\u003ch1\u003e参考ページ\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"http://p9.nyx.link/replica/\"\u003e配布ファイルの更新\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/aside\u003e\n\u003cfooter\u003e\n\t\u003cp\u003e見れない、表示がおかしい場合は、動作環境を添えて\u003ca href=\"mailto:webmaster@lufia.org\"\u003ewebmaster@lufia.org\u003c/a\u003eまで連絡ください。\u003c/p\u003e\n\u003c/footer\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/[[...slug]]","query":{"slug":["plan9","doc","adm","update"]},"buildId":"uudkrhSA2meQW-38gm1fk","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>