<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Plan 9: さくらVPSにPlan 9をインストール</title><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="author" content="http://www.hatena.ne.jp/lufiabb/"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/1b15737708df434c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1b15737708df434c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-c2e8b39087850489.js" defer=""></script><script src="/_next/static/chunks/main-7715c9ce3e92f40f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e84d751e7e95936.js" defer=""></script><script src="/_next/static/chunks/245-02c6405e66663b10.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...slug%5D%5D-663c09fbf665935a.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_buildManifest.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_ssgManifest.js" defer=""></script></head><body><div id="__next">
<nav>
	<h1>メニュー</h1>
	<ul>
	<li><a href="/plan9/index.html"><a>Plan 9</a></a></li>
	<li><a href="/plan9/doc/inst/index.html"><a>インストール</a></a></li>
	<li><a href="/plan9/doc/guide/index.html"><a>システムの使い方</a></a></li>
	<li><a href="/plan9/doc/devel/index.html"><a>プログラミング</a></a></li>
	<li><a href="/plan9/doc/adm/index.html"><a>システム管理</a></a></li>
	<li><a href="/plan9/man/index.html"><a>自作ツール集</a></a></li>
	</ul>
</nav>
<main>
	<p class="revision">2014年2月22日作成</p>
	<section>
		<h1>さくらVPSにPlan 9をインストール</h1>
		<p>さくらVPSにベル研版Plan 9をインストールしました。
		最近のさくらVPSはISOインストールが可能になっていますので、
		それを使っています。</p>
		<section>
			<h2>ISOイメージの転送</h2>
			<p>まずはさくらVPSコントロールパネルから、
			ISOアップロード用のsftpアカウントを作る必要があります。
			その後、Plan 9公式配布物のISOイメージをダウンロードして、
			(bz2を解凍してから)さくらVPSにアップロードします。</p>
			<p>アップロード用のアカウントは1日で自動的に無効化されるようです。
			また、アカウントを削除するとアップロードしたISOイメージも消えてまうので、
			やる気のあるときにアップロードすることをおすすめします。</p>
		</section>
		<section>
			<h2>Plan 9のインストール</h2>
			<p>ISOイメージのアップロードが終わったら、
			コントロールパネルのOS再インストールメニューから、
			ISOイメージからインストールを選択します。</p>
			<p>次に、インストール内容確認のところで、virtio有効にチェックが入っているので、
			これを無効にしてから、インストールを開始します。
			(virtioが有効になっていると<strong>/dev/sdC0</strong>が見つかりませんでした)</p>
		</section>
		<section>
			<h2>インストール時の設定</h2>
			<p>以下のようにインストーラからの質問へ答えました。</p>
			<table>
			<tr><th>メニュー</th><th>設定値</th></tr>
			<tr><td>dmaon</td><td>yes</td></tr>
			<tr><td>mouseport</td><td>ps2</td></tr>
			<tr><td>vgasize</td><td>1024x768x32</td></tr>
			<tr><td>monitor</td><td>xga</td></tr>
			</table>
			<p>この後、しばらくするとrioが立ち上がってきます。
			ここから先はメニューに答えるだけです。</p>
			<section>
				<h3>configfs</h3>
				<p>fossil+ventiを選びました。</p>
			</section>
			<section>
				<h3>partdisk, prepdisk</h3>
				<p>すでにLinux用のパーティションが存在しましたので、
				いちど全部を削除してから、作り直しが必要でした。
				全部削除してw, qでメニューを抜ければ、
				おすすめのパーティションが切られます。</p>
			</section>
			<section>
				<h3>fmtfossil</h3>
				<p>インストーラが不要だと判断した場合はスキップされますが、
				必ず実行しておきましょう。</p>
			</section>
			<section>
				<h3>fmtventi</h3>
				<p>fmtfossilと同様に、必ずフォーマットしておきましょう。</p>
			</section>
			<section>
				<h3>copydist</h3>
				<p>ファイルのコピーが始まります。
				今回インストールしたときは10分もかかっていない気がします。</p>
			</section>
			<section>
				<h3>bootstrap</h3>
				<p>Enable boot methodを聞かれたらplan9を選びます。
				<a href="http://www.tsubame2.org/2010/10/vps-plan-9_11.html">さくらVPSにまるまるPlan 9をインストール</a>のように、
				ctl+dで抜ける方法を使っても大丈夫です。</p>
			</section>
			<section>
				<h3>finish</h3>
				<p>インストールが一通り終わったら、再起動するように促されますが、
				その前に、<strong>plan9.ini</strong>へ行の追加が必要です。
				適当にウインドウを開いて、</p>
				<pre><code class="console">% mount /srv/dos /n/9fat /dev/sdC0/9fat
% cat /n/9fat/plan9.ini
# 無ければ、以下の2行を追加
*nomp=1
console=0 b115200 l8 pn s1
% unmount /n/9fat</code></pre>
			</section>
		</section>
		<section>
			<h2>再起動</h2>
			<p>さくらVPSのコントロールパネルから再起動したとき、
			GRUBから先に進まない状態になってしまっていたなら、
			もういちどISOからインストールを選びます。
			そうするとCDからブートしているけれど上記でインストールした
			環境を操作できるようになりますので、
			glendaでログインして以下のコマンドを実行しましょう。</p>
			<pre><code class="console">% disk/mbr -m /386/mbr /dev/sdC0/data</code></pre>
			<p>最初にventiへ書き込みをしているようで、とても重いです。
			少し待てば落ち着きます。</p>
		</section>
		<section>
			<h2>NICを認識させる</h2>
			<p>インストール直後は、</p>
			<pre><code>igbe: p-&gt;cls 0x0, setting to 0x10
igbe: bad EEPROM checksum - 0x535E</code></pre>
			<p>のようなエラーでNICが認識できていませんでしたので、<a href="https://oraccha.hatenadiary.org/entry/20100928/1285683705">さくらVPSでPlan 9</a>を参考に
			<strong>/sys/src/9/pc/etherigbe.c</strong>を以下のように変更2しました。</p>
			<pre><code class="diff">--- /sys/src/9/pc/etherigbe.c
+++ /sys/src/9/pc/etherigbe.c
-snprint(rop, sizeof(rop), &quot;S :%dDCc;&quot;, bits+3);
+snprint(rop, sizeof(rop), &quot;CcS :%dDCc;&quot;, bits+3);</code></pre>
			<p>あとはコンパイルして再起動でNICを認識できます。</p>
			<pre><code class="console">% cd /sys/src/9/pc
% mk &#x27;CONF=pcf&#x27;
% 9fat:
% mv 9pcf /n/9fat/9pcf
% mk &#x27;CONF=pcf&#x27; nuke
% fshalt</code></pre>
		</section>
	</section>
</main>
<aside>
	<h1>関連情報</h1>
	<ul>
	<li><a href="/plan9/doc/inst/virtio.html"><a>VirtIOを使う</a></a></li>
	<li><a href="/plan9/doc/inst/sizka.html"><a>Sizka BASICへのインストール</a></a></li>
	</ul>
</aside>
<footer>
	<p>見れない、表示がおかしい場合は、動作環境を添えて<a href="/plan9/doc/inst/mailto:webmaster@lufia.org"><a>webmaster@lufia.org</a></a>まで連絡ください。</p>
</footer>
</div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003c!doctype html\u003e\n\u003chtml lang=\"ja\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003ePlan 9: さくらVPSにPlan 9をインストール\u003c/title\u003e\n\u003cmeta name=\"viewport\" content=\"width=device-width,initial-scale=1\"\u003e\n\u003cmeta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cnav\u003e\n\t\u003ch1\u003eメニュー\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/index.html\"\u003ePlan 9\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/inst/index.html\"\u003eインストール\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/guide/index.html\"\u003eシステムの使い方\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/devel/index.html\"\u003eプログラミング\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/adm/index.html\"\u003eシステム管理\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/man/index.html\"\u003e自作ツール集\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/nav\u003e\n\u003cmain\u003e\n\t\u003cp class=\"revision\"\u003e2014年2月22日作成\u003c/p\u003e\n\t\u003csection\u003e\n\t\t\u003ch1\u003eさくらVPSにPlan 9をインストール\u003c/h1\u003e\n\t\t\u003cp\u003eさくらVPSにベル研版Plan 9をインストールしました。\n\t\t最近のさくらVPSはISOインストールが可能になっていますので、\n\t\tそれを使っています。\u003c/p\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eISOイメージの転送\u003c/h2\u003e\n\t\t\t\u003cp\u003eまずはさくらVPSコントロールパネルから、\n\t\t\tISOアップロード用のsftpアカウントを作る必要があります。\n\t\t\tその後、Plan 9公式配布物のISOイメージをダウンロードして、\n\t\t\t(bz2を解凍してから)さくらVPSにアップロードします。\u003c/p\u003e\n\t\t\t\u003cp\u003eアップロード用のアカウントは1日で自動的に無効化されるようです。\n\t\t\tまた、アカウントを削除するとアップロードしたISOイメージも消えてまうので、\n\t\t\tやる気のあるときにアップロードすることをおすすめします。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003ePlan 9のインストール\u003c/h2\u003e\n\t\t\t\u003cp\u003eISOイメージのアップロードが終わったら、\n\t\t\tコントロールパネルのOS再インストールメニューから、\n\t\t\tISOイメージからインストールを選択します。\u003c/p\u003e\n\t\t\t\u003cp\u003e次に、インストール内容確認のところで、virtio有効にチェックが入っているので、\n\t\t\tこれを無効にしてから、インストールを開始します。\n\t\t\t(virtioが有効になっていると\u003cstrong\u003e/dev/sdC0\u003c/strong\u003eが見つかりませんでした)\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eインストール時の設定\u003c/h2\u003e\n\t\t\t\u003cp\u003e以下のようにインストーラからの質問へ答えました。\u003c/p\u003e\n\t\t\t\u003ctable\u003e\n\t\t\t\u003ctr\u003e\u003cth\u003eメニュー\u003c/th\u003e\u003cth\u003e設定値\u003c/th\u003e\u003c/tr\u003e\n\t\t\t\u003ctr\u003e\u003ctd\u003edmaon\u003c/td\u003e\u003ctd\u003eyes\u003c/td\u003e\u003c/tr\u003e\n\t\t\t\u003ctr\u003e\u003ctd\u003emouseport\u003c/td\u003e\u003ctd\u003eps2\u003c/td\u003e\u003c/tr\u003e\n\t\t\t\u003ctr\u003e\u003ctd\u003evgasize\u003c/td\u003e\u003ctd\u003e1024x768x32\u003c/td\u003e\u003c/tr\u003e\n\t\t\t\u003ctr\u003e\u003ctd\u003emonitor\u003c/td\u003e\u003ctd\u003exga\u003c/td\u003e\u003c/tr\u003e\n\t\t\t\u003c/table\u003e\n\t\t\t\u003cp\u003eこの後、しばらくするとrioが立ち上がってきます。\n\t\t\tここから先はメニューに答えるだけです。\u003c/p\u003e\n\t\t\t\u003csection\u003e\n\t\t\t\t\u003ch3\u003econfigfs\u003c/h3\u003e\n\t\t\t\t\u003cp\u003efossil+ventiを選びました。\u003c/p\u003e\n\t\t\t\u003c/section\u003e\n\t\t\t\u003csection\u003e\n\t\t\t\t\u003ch3\u003epartdisk, prepdisk\u003c/h3\u003e\n\t\t\t\t\u003cp\u003eすでにLinux用のパーティションが存在しましたので、\n\t\t\t\tいちど全部を削除してから、作り直しが必要でした。\n\t\t\t\t全部削除してw, qでメニューを抜ければ、\n\t\t\t\tおすすめのパーティションが切られます。\u003c/p\u003e\n\t\t\t\u003c/section\u003e\n\t\t\t\u003csection\u003e\n\t\t\t\t\u003ch3\u003efmtfossil\u003c/h3\u003e\n\t\t\t\t\u003cp\u003eインストーラが不要だと判断した場合はスキップされますが、\n\t\t\t\t必ず実行しておきましょう。\u003c/p\u003e\n\t\t\t\u003c/section\u003e\n\t\t\t\u003csection\u003e\n\t\t\t\t\u003ch3\u003efmtventi\u003c/h3\u003e\n\t\t\t\t\u003cp\u003efmtfossilと同様に、必ずフォーマットしておきましょう。\u003c/p\u003e\n\t\t\t\u003c/section\u003e\n\t\t\t\u003csection\u003e\n\t\t\t\t\u003ch3\u003ecopydist\u003c/h3\u003e\n\t\t\t\t\u003cp\u003eファイルのコピーが始まります。\n\t\t\t\t今回インストールしたときは10分もかかっていない気がします。\u003c/p\u003e\n\t\t\t\u003c/section\u003e\n\t\t\t\u003csection\u003e\n\t\t\t\t\u003ch3\u003ebootstrap\u003c/h3\u003e\n\t\t\t\t\u003cp\u003eEnable boot methodを聞かれたらplan9を選びます。\n\t\t\t\t\u003ca href=\"http://www.tsubame2.org/2010/10/vps-plan-9_11.html\"\u003eさくらVPSにまるまるPlan 9をインストール\u003c/a\u003eのように、\n\t\t\t\tctl+dで抜ける方法を使っても大丈夫です。\u003c/p\u003e\n\t\t\t\u003c/section\u003e\n\t\t\t\u003csection\u003e\n\t\t\t\t\u003ch3\u003efinish\u003c/h3\u003e\n\t\t\t\t\u003cp\u003eインストールが一通り終わったら、再起動するように促されますが、\n\t\t\t\tその前に、\u003cstrong\u003eplan9.ini\u003c/strong\u003eへ行の追加が必要です。\n\t\t\t\t適当にウインドウを開いて、\u003c/p\u003e\n\t\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% mount /srv/dos /n/9fat /dev/sdC0/9fat\n% cat /n/9fat/plan9.ini\n# 無ければ、以下の2行を追加\n*nomp=1\nconsole=0 b115200 l8 pn s1\n% unmount /n/9fat\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003c/section\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003e再起動\u003c/h2\u003e\n\t\t\t\u003cp\u003eさくらVPSのコントロールパネルから再起動したとき、\n\t\t\tGRUBから先に進まない状態になってしまっていたなら、\n\t\t\tもういちどISOからインストールを選びます。\n\t\t\tそうするとCDからブートしているけれど上記でインストールした\n\t\t\t環境を操作できるようになりますので、\n\t\t\tglendaでログインして以下のコマンドを実行しましょう。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% disk/mbr -m /386/mbr /dev/sdC0/data\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003e最初にventiへ書き込みをしているようで、とても重いです。\n\t\t\t少し待てば落ち着きます。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eNICを認識させる\u003c/h2\u003e\n\t\t\t\u003cp\u003eインストール直後は、\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode\u003eigbe: p-\u0026gt;cls 0x0, setting to 0x10\nigbe: bad EEPROM checksum - 0x535E\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eのようなエラーでNICが認識できていませんでしたので、\u003ca href=\"https://oraccha.hatenadiary.org/entry/20100928/1285683705\"\u003eさくらVPSでPlan 9\u003c/a\u003eを参考に\n\t\t\t\u003cstrong\u003e/sys/src/9/pc/etherigbe.c\u003c/strong\u003eを以下のように変更2しました。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"diff\"\u003e--- /sys/src/9/pc/etherigbe.c\n+++ /sys/src/9/pc/etherigbe.c\n-snprint(rop, sizeof(rop), \u0026quot;S :%dDCc;\u0026quot;, bits+3);\n+snprint(rop, sizeof(rop), \u0026quot;CcS :%dDCc;\u0026quot;, bits+3);\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eあとはコンパイルして再起動でNICを認識できます。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% cd /sys/src/9/pc\n% mk 'CONF=pcf'\n% 9fat:\n% mv 9pcf /n/9fat/9pcf\n% mk 'CONF=pcf' nuke\n% fshalt\u003c/code\u003e\u003c/pre\u003e\n\t\t\u003c/section\u003e\n\t\u003c/section\u003e\n\u003c/main\u003e\n\u003caside\u003e\n\t\u003ch1\u003e関連情報\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"virtio.html\"\u003eVirtIOを使う\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"sizka.html\"\u003eSizka BASICへのインストール\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/aside\u003e\n\u003cfooter\u003e\n\t\u003cp\u003e見れない、表示がおかしい場合は、動作環境を添えて\u003ca href=\"mailto:webmaster@lufia.org\"\u003ewebmaster@lufia.org\u003c/a\u003eまで連絡ください。\u003c/p\u003e\n\u003c/footer\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/[[...slug]]","query":{"slug":["plan9","doc","inst","vps"]},"buildId":"uudkrhSA2meQW-38gm1fk","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>