<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Plan 9: bloomフィルタ付きventiを作る</title><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="author" content="http://www.hatena.ne.jp/lufiabb/"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/1b15737708df434c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1b15737708df434c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-c2e8b39087850489.js" defer=""></script><script src="/_next/static/chunks/main-7715c9ce3e92f40f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e84d751e7e95936.js" defer=""></script><script src="/_next/static/chunks/245-02c6405e66663b10.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...slug%5D%5D-663c09fbf665935a.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_buildManifest.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_ssgManifest.js" defer=""></script></head><body><div id="__next">
<nav>
	<h1>メニュー</h1>
	<ul>
	<li><a href="/plan9/index.html"><a>Plan 9</a></a></li>
	<li><a href="/plan9/doc/inst/index.html"><a>インストール</a></a></li>
	<li><a href="/plan9/doc/guide/index.html"><a>システムの使い方</a></a></li>
	<li><a href="/plan9/doc/devel/index.html"><a>プログラミング</a></a></li>
	<li><a href="/plan9/doc/adm/index.html"><a>システム管理</a></a></li>
	<li><a href="/plan9/man/index.html"><a>自作ツール集</a></a></li>
	</ul>
</nav>
<main>
	<p class="revision">2015年5月4日更新</p>
	<section>
		<h1>bloomフィルタ付きventiを作る</h1>
		<p>現在の(ベル研が配布している)インストールCDは、
		ventiのbloomフィルタを作成しません。
		インストールが終わってからbloomフィルタを追加するのは
		ディスクを追加したりと面倒なので、インストール時に作っておきます。</p>
		<section>
			<h2>インストール中で</h2>
			<p>CDイメージからブートしたら、prepdiskまではそのまま進めます。
			prepdiskまで進んだら、別のwindowを開いてprepdiskを手動実行します。</p>
			<pre><code class="console">% disk/prep -a 9fat -a nvram -a arenas -a isect -a bloom -a fossil -a swap /dev/sdC0/plan9
% disk/prep -p /dev/sdC0/plan9 &gt;/dev/sdC0/ctl</code></pre>
			<p>終わったらwindowを閉じて、prepdiskを実行しますが、
			prepdiskは終わっているので、そのままqでprepdiskを抜けて次へ進めます。</p>
		</section>
		<section>
			<h2>初回ブートのあと</h2>
			<p><strong>/dev/swap</strong>の値を以下に設定して、bloomsizeを計算します。</p>
			<pre><code class="awk">#!/usr/bin/awk -f

BEGIN {
	# cat /dev/swap
	pgsize = 4096 # /dev/swapのpagesize
	userused = 1424 # /dev/swapのuser左側
	userpgs = 458749 # /dev/swapのuser右側

	userfree = (userpgs-userused)*pgsize
	bloomsize = 2 ^ int(log(userfree/1024/1024*20/100*1/3) / log(2))
	print bloomsize
}</code></pre>
			<p>上記結果をfmtbloomの-sオプションに与えてフォーマットします。</p>
			<pre><code class="console">% venti/fmtbloom -s 64m /dev/sdC0/bloom</code></pre>
			<p>あとは<strong>venti.conf</strong>にbloomを設定します。</p>
			<pre><code class="console">% venti/conf /dev/sdC0/arenas &gt;/tmp/venti.conf
(isectとarenasの間あたりに追加)
bloom /dev/sdC0/bloom
% venti/conf -w /dev/sdC0/arenas /venti.conf</code></pre>
		</section>
	</section>
</main>
<footer>
	<p>見れない、表示がおかしい場合は、動作環境を添えて<a href="/plan9/doc/inst/mailto:webmaster@lufia.org"><a>webmaster@lufia.org</a></a>まで連絡ください。</p>
</footer>
</div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003c!doctype html\u003e\n\u003chtml lang=\"ja\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003ePlan 9: bloomフィルタ付きventiを作る\u003c/title\u003e\n\u003cmeta name=\"viewport\" content=\"width=device-width,initial-scale=1\"\u003e\n\u003cmeta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cnav\u003e\n\t\u003ch1\u003eメニュー\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/index.html\"\u003ePlan 9\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/inst/index.html\"\u003eインストール\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/guide/index.html\"\u003eシステムの使い方\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/devel/index.html\"\u003eプログラミング\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/doc/adm/index.html\"\u003eシステム管理\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/man/index.html\"\u003e自作ツール集\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/nav\u003e\n\u003cmain\u003e\n\t\u003cp class=\"revision\"\u003e2015年5月4日更新\u003c/p\u003e\n\t\u003csection\u003e\n\t\t\u003ch1\u003ebloomフィルタ付きventiを作る\u003c/h1\u003e\n\t\t\u003cp\u003e現在の(ベル研が配布している)インストールCDは、\n\t\tventiのbloomフィルタを作成しません。\n\t\tインストールが終わってからbloomフィルタを追加するのは\n\t\tディスクを追加したりと面倒なので、インストール時に作っておきます。\u003c/p\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eインストール中で\u003c/h2\u003e\n\t\t\t\u003cp\u003eCDイメージからブートしたら、prepdiskまではそのまま進めます。\n\t\t\tprepdiskまで進んだら、別のwindowを開いてprepdiskを手動実行します。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% disk/prep -a 9fat -a nvram -a arenas -a isect -a bloom -a fossil -a swap /dev/sdC0/plan9\n% disk/prep -p /dev/sdC0/plan9 \u0026gt;/dev/sdC0/ctl\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003e終わったらwindowを閉じて、prepdiskを実行しますが、\n\t\t\tprepdiskは終わっているので、そのままqでprepdiskを抜けて次へ進めます。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003e初回ブートのあと\u003c/h2\u003e\n\t\t\t\u003cp\u003e\u003cstrong\u003e/dev/swap\u003c/strong\u003eの値を以下に設定して、bloomsizeを計算します。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"awk\"\u003e#!/usr/bin/awk -f\n\nBEGIN {\n\t# cat /dev/swap\n\tpgsize = 4096 # /dev/swapのpagesize\n\tuserused = 1424 # /dev/swapのuser左側\n\tuserpgs = 458749 # /dev/swapのuser右側\n\n\tuserfree = (userpgs-userused)*pgsize\n\tbloomsize = 2 ^ int(log(userfree/1024/1024*20/100*1/3) / log(2))\n\tprint bloomsize\n}\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003e上記結果をfmtbloomの-sオプションに与えてフォーマットします。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% venti/fmtbloom -s 64m /dev/sdC0/bloom\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eあとは\u003cstrong\u003eventi.conf\u003c/strong\u003eにbloomを設定します。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e% venti/conf /dev/sdC0/arenas \u0026gt;/tmp/venti.conf\n(isectとarenasの間あたりに追加)\nbloom /dev/sdC0/bloom\n% venti/conf -w /dev/sdC0/arenas /venti.conf\u003c/code\u003e\u003c/pre\u003e\n\t\t\u003c/section\u003e\n\t\u003c/section\u003e\n\u003c/main\u003e\n\u003cfooter\u003e\n\t\u003cp\u003e見れない、表示がおかしい場合は、動作環境を添えて\u003ca href=\"mailto:webmaster@lufia.org\"\u003ewebmaster@lufia.org\u003c/a\u003eまで連絡ください。\u003c/p\u003e\n\u003c/footer\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/[[...slug]]","query":{"slug":["plan9","doc","inst","bloom"]},"buildId":"uudkrhSA2meQW-38gm1fk","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>