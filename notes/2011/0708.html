<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>orange/note: Excelメモ</title><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="author" content="http://www.hatena.ne.jp/lufiabb/"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/1b15737708df434c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1b15737708df434c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-c2e8b39087850489.js" defer=""></script><script src="/_next/static/chunks/main-7715c9ce3e92f40f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e84d751e7e95936.js" defer=""></script><script src="/_next/static/chunks/245-02c6405e66663b10.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...slug%5D%5D-663c09fbf665935a.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_buildManifest.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_ssgManifest.js" defer=""></script></head><body><div id="__next">
<nav>
	<h1>メニュー</h1>
	<ul>
	<li><a href="/notes/index.html"><a>orange/note</a></a></li>
	<li><a href="/notes/pc.html"><a>PC関連</a></a></li>
	<li><a href="/notes/web.html"><a>web製作</a></a></li>
	<li><a href="/notes/sec.html"><a>セキュリティ</a></a></li>
	<li><a href="/notes/hobby.html"><a>本・ゲーム</a></a></li>
	<li><a href="/notes/junk.html"><a>ジャンク</a></a></li>
	</ul>
</nav>
<main>
	<p class="revision">2011年7月8日作成</p>
	<section>
		<h1>Excelメモ</h1>
		<p>セルをコピーするとアドレスをずらしてくれるのは、
		だいたいの場合にとても便利ですが、
		相対アドレスのままシフトせずにコピーしたいときもありまして。</p>
		<p>まあ、全部手作業でやればいいかなあとも考えましたが、
		件数が多くてめんどくさかったので固定コピー機能を書きました。
		これを<a href="http://allabout.co.jp/gm/gc/297809/">個人用マクロブック</a>に置いて、
		AbsoluteCopyにCtl+Y、AbsolutePasteにCtl+Pあたりを割り当てました。
		マクロメニューから呼び出すと、マクロが呼び出された時点で
		Excelからみえるクリップボードが消えているためショートカットキー必須です。</p>
		<pre><code>Sub AbsoluteCopy()
	Dim p As Range
	Dim p1 As Range
	Dim w As Worksheet
	Dim w1 As Worksheet
	Dim addr As String
	
	addr = Selection.Address	&#x27; CreateTempの結果、アドレスが変わるので退避
	Selection.Copy
	Set w = ActiveSheet
	Set w1 = CreateTemp(&quot;tmp&quot;)
	Set p = w1.Range(addr)
	p.PasteSpecial
	For Each p1 In p
		If p1.HasFormula Then
			p1.Formula = Application.ConvertFormula(p1.Formula, xlA1, , xlAbsolute)
		End If
	Next
	p.Copy
	w.Activate
	Debug.Print Application.ClipboardFormats(1)
End Sub

Sub AbsolutePaste()
	Dim p1 As Range
	
	Selection.PasteSpecial
	For Each p1 In Selection
		If p1.HasFormula Then
			p1.Formula = Application.ConvertFormula(p1.Formula, xlA1, xlA1, xlRelative)
		End If
	Next
End Sub

Function CreateTemp(ByVal s As String) As Worksheet
	Dim i As Integer
	Dim w As Worksheet
	
	If Not IsExist(s) Then
		Set w = ThisWorkbook.Sheets.Add()
		w.Name = s
		Set CreateTemp = w
		Exit Function
	End If
	
	i = 1
	Do While IsExist(s &amp; i)
		i = i + 1
	Loop
	
	Set w = ThisWorkbook.Sheets.Add()
	w.Name = s &amp; i
	Set CreateTemp = w
End Function

Function IsExist(ByVal s As String) As Boolean
	Dim i As Integer
	
	For i = 1 To ThisWorkbook.Sheets.Count
		If ThisWorkbook.Sheets(i).Name = s Then
			IsExist = True
			Exit Function
		End If
	Next
	IsExist = False
End Function</code></pre>
	</section>
</main>
<aside>
	<h1>関連情報</h1>
	<ul>
	<li><a href="http://www.officetanaka.net/excel/vba/tips/tips117.htm">相対参照と絶対参照を変換する</a></li>
	</ul>
</aside>
<aside>
	<h1>やっていること</h1>
	<ul>
	<li><a href="/plan9/index.html"><a>Plan 9</a></a></li>
	<li><a href="http://web.me.com/lufia/alefcompiler/alef/">Alefコンパイラを読む</a></li>
	</ul>
</aside>
<footer>
	<p>見れない、表示がおかしい場合は、動作環境を添えて<a href="/notes/2011/mailto:webmaster@lufia.org"><a>webmaster@lufia.org</a></a>まで連絡ください。</p>
</footer>
</div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003c!doctype html\u003e\n\u003chtml lang=\"ja\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003eorange/note: Excelメモ\u003c/title\u003e\n\u003cmeta name=\"viewport\" content=\"width=device-width,initial-scale=1\"\u003e\n\u003cmeta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cnav\u003e\n\t\u003ch1\u003eメニュー\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/index.html\"\u003eorange/note\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/pc.html\"\u003ePC関連\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/web.html\"\u003eweb製作\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/sec.html\"\u003eセキュリティ\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/hobby.html\"\u003e本・ゲーム\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/junk.html\"\u003eジャンク\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/nav\u003e\n\u003cmain\u003e\n\t\u003cp class=\"revision\"\u003e2011年7月8日作成\u003c/p\u003e\n\t\u003csection\u003e\n\t\t\u003ch1\u003eExcelメモ\u003c/h1\u003e\n\t\t\u003cp\u003eセルをコピーするとアドレスをずらしてくれるのは、\n\t\tだいたいの場合にとても便利ですが、\n\t\t相対アドレスのままシフトせずにコピーしたいときもありまして。\u003c/p\u003e\n\t\t\u003cp\u003eまあ、全部手作業でやればいいかなあとも考えましたが、\n\t\t件数が多くてめんどくさかったので固定コピー機能を書きました。\n\t\tこれを\u003ca href=\"http://allabout.co.jp/gm/gc/297809/\"\u003e個人用マクロブック\u003c/a\u003eに置いて、\n\t\tAbsoluteCopyにCtl+Y、AbsolutePasteにCtl+Pあたりを割り当てました。\n\t\tマクロメニューから呼び出すと、マクロが呼び出された時点で\n\t\tExcelからみえるクリップボードが消えているためショートカットキー必須です。\u003c/p\u003e\n\t\t\u003cpre\u003e\u003ccode\u003eSub AbsoluteCopy()\n\tDim p As Range\n\tDim p1 As Range\n\tDim w As Worksheet\n\tDim w1 As Worksheet\n\tDim addr As String\n\t\n\taddr = Selection.Address\t' CreateTempの結果、アドレスが変わるので退避\n\tSelection.Copy\n\tSet w = ActiveSheet\n\tSet w1 = CreateTemp(\u0026quot;tmp\u0026quot;)\n\tSet p = w1.Range(addr)\n\tp.PasteSpecial\n\tFor Each p1 In p\n\t\tIf p1.HasFormula Then\n\t\t\tp1.Formula = Application.ConvertFormula(p1.Formula, xlA1, , xlAbsolute)\n\t\tEnd If\n\tNext\n\tp.Copy\n\tw.Activate\n\tDebug.Print Application.ClipboardFormats(1)\nEnd Sub\n\nSub AbsolutePaste()\n\tDim p1 As Range\n\t\n\tSelection.PasteSpecial\n\tFor Each p1 In Selection\n\t\tIf p1.HasFormula Then\n\t\t\tp1.Formula = Application.ConvertFormula(p1.Formula, xlA1, xlA1, xlRelative)\n\t\tEnd If\n\tNext\nEnd Sub\n\nFunction CreateTemp(ByVal s As String) As Worksheet\n\tDim i As Integer\n\tDim w As Worksheet\n\t\n\tIf Not IsExist(s) Then\n\t\tSet w = ThisWorkbook.Sheets.Add()\n\t\tw.Name = s\n\t\tSet CreateTemp = w\n\t\tExit Function\n\tEnd If\n\t\n\ti = 1\n\tDo While IsExist(s \u0026amp; i)\n\t\ti = i + 1\n\tLoop\n\t\n\tSet w = ThisWorkbook.Sheets.Add()\n\tw.Name = s \u0026amp; i\n\tSet CreateTemp = w\nEnd Function\n\nFunction IsExist(ByVal s As String) As Boolean\n\tDim i As Integer\n\t\n\tFor i = 1 To ThisWorkbook.Sheets.Count\n\t\tIf ThisWorkbook.Sheets(i).Name = s Then\n\t\t\tIsExist = True\n\t\t\tExit Function\n\t\tEnd If\n\tNext\n\tIsExist = False\nEnd Function\u003c/code\u003e\u003c/pre\u003e\n\t\u003c/section\u003e\n\u003c/main\u003e\n\u003caside\u003e\n\t\u003ch1\u003e関連情報\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"http://www.officetanaka.net/excel/vba/tips/tips117.htm\"\u003e相対参照と絶対参照を変換する\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/aside\u003e\n\u003caside\u003e\n\t\u003ch1\u003eやっていること\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/index.html\"\u003ePlan 9\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"http://web.me.com/lufia/alefcompiler/alef/\"\u003eAlefコンパイラを読む\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/aside\u003e\n\u003cfooter\u003e\n\t\u003cp\u003e見れない、表示がおかしい場合は、動作環境を添えて\u003ca href=\"mailto:webmaster@lufia.org\"\u003ewebmaster@lufia.org\u003c/a\u003eまで連絡ください。\u003c/p\u003e\n\u003c/footer\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/[[...slug]]","query":{"slug":["notes","2011","0708"]},"buildId":"uudkrhSA2meQW-38gm1fk","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>