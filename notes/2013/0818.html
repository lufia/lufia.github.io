<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>orange/note: Mac OS Xのパッケージ管理</title><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="author" content="http://www.hatena.ne.jp/lufiabb/"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/1b15737708df434c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1b15737708df434c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-c2e8b39087850489.js" defer=""></script><script src="/_next/static/chunks/main-7715c9ce3e92f40f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e84d751e7e95936.js" defer=""></script><script src="/_next/static/chunks/245-02c6405e66663b10.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...slug%5D%5D-663c09fbf665935a.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_buildManifest.js" defer=""></script><script src="/_next/static/uudkrhSA2meQW-38gm1fk/_ssgManifest.js" defer=""></script></head><body><div id="__next">
<nav>
	<h1>メニュー</h1>
	<ul>
	<li><a href="/notes/index.html"><a>orange/note</a></a></li>
	<li><a href="/notes/pc.html"><a>PC関連</a></a></li>
	<li><a href="/notes/web.html"><a>web製作</a></a></li>
	<li><a href="/notes/sec.html"><a>セキュリティ</a></a></li>
	<li><a href="/notes/hobby.html"><a>本・ゲーム</a></a></li>
	<li><a href="/notes/junk.html"><a>ジャンク</a></a></li>
	</ul>
</nav>
<main>
	<p class="revision">2013年8月18日作成</p>
	<section>
		<h1>Mac OS Xのパッケージ管理</h1>
		<p>Macは、.app形式でアプリケーションを提供しているものと、
		インストーラ付きの.pkg形式のものがあります。
		前者は.appをまるっとゴミ箱に捨てればいいのですが、
		後者の場合、ファイルがいくつかの場所に分散するので簡単ではありません。
		そういった.pkgの管理について少しメモ。</p>
		<p class="note">どちらの形式でも、ユーザごとの設定ファイル等は$HOME/Library/以下に
		作成されている場合があります。探して消しましょう。</p>
		<section>
			<h2>インストール済みパッケージを調べる</h2>
			<pre><code class="console">$ pkgutil --pkgs</code></pre>
			<p>インストール済みのパッケージIDが表示されます。
			com.apple.のものがいっぱいあるので、grep -vしておくと便利です。</p>
		</section>
		<section>
			<h2>パッケージのインストール先を調べる</h2>
			<pre><code class="console">$ pkgutil --info {パッケージID}</code></pre>
			<p>上記コマンドの出力結果から、
			volumeとlocationを繋げた場所にインストールされています。</p>
			<pre><code>version: 17.0.2004.1119
volume: /
location: 
install-time: 1358076145</code></pre>
			<p>たとえば、この場合は/直下です。</p>
		</section>
		<section>
			<h2>パッケージに含まれるファイルを調べる</h2>
			<pre><code class="console">$ pkgutil --files {パッケージID}</code></pre>
			<p>ディレクトリ、ファイルを問わずすべて列挙します。
			たとえば--infoで調べたインストール先が/直下で、--filesの結果が</p>
			<pre><code>Applications
Applications/Example.app
Applications/Example.app/file</code></pre>
			<p>であれば、実際のファイルは/Applications/Example.app/fileです。</p>
		</section>
		<section>
			<h2>パッケージを削除する</h2>
			<p>Lion以前はpkgutil --unlinkが存在していたようですが、
			Mountain Lionからは無くなってしまったため、少々面倒です。</p>
			<p>まずは、ファイルを削除します。
			上記で挙げた例の場合、--infoと--filesの結果を組み合わせて、
			Example.appを手動で削除すればいいと思われます。
			ただし、ほとんどの場合、/Applicationsは消せないでしょう。
			削除するべきファイルとそうでないファイルを区別するのが少々面倒です。</p>
			<p class="note">Githubに、<a href="https://github.com/niw/profiles/blob/master/bin/rm_pkg_files">rm_pkg_files</a>が
			ありましたが、--filesの結果をみて、削除しているだけのようです。</p>
			<p>次に、インストールした情報を削除します。</p>
			<pre><code>sudo pkgutil --forget {パッケージID}</code></pre>
			<p>他のコマンドと異なり、システムに手を入れるのでsudoが必要です。</p>
			<p class="note">Mountain Lionでは、/Library/Receipts/InstallHistory.plistに
			インストール履歴があり、/private/var/db/receipts/以下に
			各種パッケージのbomとplistファイルがありますけれど、
			OSのバージョンによって変更される可能性があるためpkgutilを使え、
			ということみたいです。</p>
		</section>
		<section>
			<h2>削除できないパッケージを削除する</h2>
			<p>pkgutil --forgetで削除すると、以下のようなエラーになる場合があります。</p>
			<pre><code>Unknown error Error Domain=NSCocoaErrorDomain Code=4 &quot;“com.apple.pkg.iPhoto_710.bom” couldn’t be removed.&quot; UserInfo=0x7f97b2673470 {NSFilePath=/var/db/receipts/com.apple.pkg.iPhoto_710.bom, NSUserStringVariant=(
	Remove
), NSUnderlyingError=0x7f97b263ac80 &quot;The operation couldn’t be completed. No such file or directory&quot;}.
Forgot package &#x27;com.apple.pkg.iPhoto_710&#x27; on &#x27;/&#x27;.</code></pre>
			<p>この場合は、/Library/Receipts以下にゴミが残っているだけなので、
			削除したいpkgファイルを上記ディレクトリから手動で消してしまえば問題ありません。</p>
		</section>
	</section>
</main>
<aside>
	<h1>参考サイト</h1>
	<ul>
	<li><a href="http://blog.niw.at/post/16690761384">Mac OS Xのパッケージファイルを操作する</a></li>
	</ul>
</aside>
<aside>
	<h1>やっていること</h1>
	<ul>
	<li><a href="/plan9/index.html"><a>Plan 9</a></a></li>
	<li><a href="http://web.me.com/lufia/alefcompiler/alef/">Alefコンパイラを読む</a></li>
	</ul>
</aside>
<footer>
	<p>見れない、表示がおかしい場合は、動作環境を添えて<a href="/notes/2013/mailto:webmaster@lufia.org"><a>webmaster@lufia.org</a></a>まで連絡ください。</p>
</footer>
</div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"html":"\u003c!doctype html\u003e\n\u003chtml lang=\"ja\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003eorange/note: Mac OS Xのパッケージ管理\u003c/title\u003e\n\u003cmeta name=\"viewport\" content=\"width=device-width,initial-scale=1\"\u003e\n\u003cmeta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cnav\u003e\n\t\u003ch1\u003eメニュー\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/index.html\"\u003eorange/note\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/pc.html\"\u003ePC関連\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/web.html\"\u003eweb製作\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/sec.html\"\u003eセキュリティ\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/hobby.html\"\u003e本・ゲーム\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"/notes/junk.html\"\u003eジャンク\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/nav\u003e\n\u003cmain\u003e\n\t\u003cp class=\"revision\"\u003e2013年8月18日作成\u003c/p\u003e\n\t\u003csection\u003e\n\t\t\u003ch1\u003eMac OS Xのパッケージ管理\u003c/h1\u003e\n\t\t\u003cp\u003eMacは、.app形式でアプリケーションを提供しているものと、\n\t\tインストーラ付きの.pkg形式のものがあります。\n\t\t前者は.appをまるっとゴミ箱に捨てればいいのですが、\n\t\t後者の場合、ファイルがいくつかの場所に分散するので簡単ではありません。\n\t\tそういった.pkgの管理について少しメモ。\u003c/p\u003e\n\t\t\u003cp class=\"note\"\u003eどちらの形式でも、ユーザごとの設定ファイル等は$HOME/Library/以下に\n\t\t作成されている場合があります。探して消しましょう。\u003c/p\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eインストール済みパッケージを調べる\u003c/h2\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e$ pkgutil --pkgs\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eインストール済みのパッケージIDが表示されます。\n\t\t\tcom.apple.のものがいっぱいあるので、grep -vしておくと便利です。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eパッケージのインストール先を調べる\u003c/h2\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e$ pkgutil --info {パッケージID}\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003e上記コマンドの出力結果から、\n\t\t\tvolumeとlocationを繋げた場所にインストールされています。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode\u003eversion: 17.0.2004.1119\nvolume: /\nlocation: \ninstall-time: 1358076145\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eたとえば、この場合は/直下です。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eパッケージに含まれるファイルを調べる\u003c/h2\u003e\n\t\t\t\u003cpre\u003e\u003ccode class=\"console\"\u003e$ pkgutil --files {パッケージID}\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eディレクトリ、ファイルを問わずすべて列挙します。\n\t\t\tたとえば--infoで調べたインストール先が/直下で、--filesの結果が\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode\u003eApplications\nApplications/Example.app\nApplications/Example.app/file\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eであれば、実際のファイルは/Applications/Example.app/fileです。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003eパッケージを削除する\u003c/h2\u003e\n\t\t\t\u003cp\u003eLion以前はpkgutil --unlinkが存在していたようですが、\n\t\t\tMountain Lionからは無くなってしまったため、少々面倒です。\u003c/p\u003e\n\t\t\t\u003cp\u003eまずは、ファイルを削除します。\n\t\t\t上記で挙げた例の場合、--infoと--filesの結果を組み合わせて、\n\t\t\tExample.appを手動で削除すればいいと思われます。\n\t\t\tただし、ほとんどの場合、/Applicationsは消せないでしょう。\n\t\t\t削除するべきファイルとそうでないファイルを区別するのが少々面倒です。\u003c/p\u003e\n\t\t\t\u003cp class=\"note\"\u003eGithubに、\u003ca href=\"https://github.com/niw/profiles/blob/master/bin/rm_pkg_files\"\u003erm_pkg_files\u003c/a\u003eが\n\t\t\tありましたが、--filesの結果をみて、削除しているだけのようです。\u003c/p\u003e\n\t\t\t\u003cp\u003e次に、インストールした情報を削除します。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode\u003esudo pkgutil --forget {パッケージID}\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003e他のコマンドと異なり、システムに手を入れるのでsudoが必要です。\u003c/p\u003e\n\t\t\t\u003cp class=\"note\"\u003eMountain Lionでは、/Library/Receipts/InstallHistory.plistに\n\t\t\tインストール履歴があり、/private/var/db/receipts/以下に\n\t\t\t各種パッケージのbomとplistファイルがありますけれど、\n\t\t\tOSのバージョンによって変更される可能性があるためpkgutilを使え、\n\t\t\tということみたいです。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\t\u003csection\u003e\n\t\t\t\u003ch2\u003e削除できないパッケージを削除する\u003c/h2\u003e\n\t\t\t\u003cp\u003epkgutil --forgetで削除すると、以下のようなエラーになる場合があります。\u003c/p\u003e\n\t\t\t\u003cpre\u003e\u003ccode\u003eUnknown error Error Domain=NSCocoaErrorDomain Code=4 \u0026quot;“com.apple.pkg.iPhoto_710.bom” couldn’t be removed.\u0026quot; UserInfo=0x7f97b2673470 {NSFilePath=/var/db/receipts/com.apple.pkg.iPhoto_710.bom, NSUserStringVariant=(\n\tRemove\n), NSUnderlyingError=0x7f97b263ac80 \u0026quot;The operation couldn’t be completed. No such file or directory\u0026quot;}.\nForgot package 'com.apple.pkg.iPhoto_710' on '/'.\u003c/code\u003e\u003c/pre\u003e\n\t\t\t\u003cp\u003eこの場合は、/Library/Receipts以下にゴミが残っているだけなので、\n\t\t\t削除したいpkgファイルを上記ディレクトリから手動で消してしまえば問題ありません。\u003c/p\u003e\n\t\t\u003c/section\u003e\n\t\u003c/section\u003e\n\u003c/main\u003e\n\u003caside\u003e\n\t\u003ch1\u003e参考サイト\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"http://blog.niw.at/post/16690761384\"\u003eMac OS Xのパッケージファイルを操作する\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/aside\u003e\n\u003caside\u003e\n\t\u003ch1\u003eやっていること\u003c/h1\u003e\n\t\u003cul\u003e\n\t\u003cli\u003e\u003ca href=\"/plan9/index.html\"\u003ePlan 9\u003c/a\u003e\u003c/li\u003e\n\t\u003cli\u003e\u003ca href=\"http://web.me.com/lufia/alefcompiler/alef/\"\u003eAlefコンパイラを読む\u003c/a\u003e\u003c/li\u003e\n\t\u003c/ul\u003e\n\u003c/aside\u003e\n\u003cfooter\u003e\n\t\u003cp\u003e見れない、表示がおかしい場合は、動作環境を添えて\u003ca href=\"mailto:webmaster@lufia.org\"\u003ewebmaster@lufia.org\u003c/a\u003eまで連絡ください。\u003c/p\u003e\n\u003c/footer\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/[[...slug]]","query":{"slug":["notes","2013","0818"]},"buildId":"uudkrhSA2meQW-38gm1fk","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>