{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>Plan 9: Plan 9のアップデート</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"/plan9/doc/inst/index.html\">インストール</a></li>\n\t<li><a href=\"/plan9/doc/guide/index.html\">システムの使い方</a></li>\n\t<li><a href=\"/plan9/doc/devel/index.html\">プログラミング</a></li>\n\t<li><a href=\"/plan9/doc/adm/index.html\">システム管理</a></li>\n\t<li><a href=\"/plan9/man/index.html\">自作ツール集</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2011年12月3日更新</p>\n\t<section>\n\t\t<h1>Plan 9のアップデート</h1>\n\t\t<p>似たような記事が<a href=\"../inst/fs.html\">ファイルサーバのインストール</a>\n\t\tにもありますが、こちらはPlan 9環境全体のアップデート。\n\t\tあちらはken fsソースそのもののアップデートになります。</p>\n\t\t<p>fs環境で使っていると、<strong>/dist/replica/network</strong>が\n\t\tうまく動いてくれません。fossilもkfsも無いからね。\n\t\tなので、replicaするには自分で設定ファイルを作ります。</p>\n\t\t<pre><code class=\"console\">fs: create /dist/replica/inst sys sys 775</code></pre>\n\t\t<p>以下が<strong>/dist/replica/inst</strong>の内容。</p>\n\t\t<pre><code class=\"sh\">#!/bin/rc\n\n# Generic plan9 installation template.\n# Assumes that distribution CD or sources\n# is mounted at /n/dist, and should be installed\n# to /n/inst.\n\ns=/n/dist/dist/replica\nserverroot=/n/dist\nserverlog=$s/plan9.log\nserverproto=$s/plan9.proto\nfn servermount { status='' } \nfn serverupdate { status='' }\n\nfn clientmount { status='' }\nc=/n/inst/dist/replica\nclientroot=/n/inst\nclientproto=$c/plan9.proto\nclientdb=$c/client/plan9.db\nclientexclude=(dist/replica/client)\nclientlog=$c/client/plan9.log\n\napplyopt=(-t -u -T$c/client/plan9.time)</code></pre>\n\t\t<p>実際にreplicaするときは以下のように。\n\t\tファイルサーバ側でallowするのを忘れないように。</p>\n\t\t<pre><code class=\"console\">% mount -c /srv/boot /n/inst\n% 9fs sources\n% bind /n/sources/plan9 /n/dist\nfs: allow\n% replica/pull -v /dist/replica/inst</code></pre>\n\t\t<p>以上でアップデートが行われます。\n\t\tとても時間がかかるので、ゲームでも遊びながら待ちましょう。</p>\n\t\t<p>pullに-vオプションを与えると詳細が表示されます。\n\t\tこのとき出てくる文字は、</p>\n\t\t<dl>\n\t\t<div>\n\t\t\t<dt>a</dt>\n\t\t\t<dd>追加</dd>\n\t\t</div>\n\t\t<div>\n\t\t\t<dt>c</dt>\n\t\t\t<dd>ファイル内容の変更</dd>\n\t\t</div>\n\t\t<div>\n\t\t\t<dt>d</dt>\n\t\t\t<dd>ファイルの削除</dd>\n\t\t</div>\n\t\t<div>\n\t\t\t<dt>m</dt>\n\t\t\t<dd>メタデータ(パーミッションとか)の変更</dd>\n\t\t</div>\n\t\t<div>\n\t\t\t<dt>!</dt>\n\t\t\t<dd>競合しているので変更しない</dd>\n\t\t</div>\n\t\t</dl>\n\t\t<p>のようになっています。\n\t\t競合した場合、サーバのファイルで更新したいときは、\n\t\t全体のアップデートが終わった後で以下のように書きます。</p>\n\t\t<pre><code class=\"console\">% replica/pull -s sys/src/9/pcflop /dist/replica/inst</code></pre>\n\t\t<p>これでしばらく待つと、/sys/src/9/pcflopがサーバのもので更新されます。\n\t\t競合が複数ある場合は、-sオプションを必要なだけ使って指示します。</p>\n\t\t<pre><code class=\"console\">% replica/pull -s file1 -s file2 /dist/replica/inst</code></pre>\n\t\t<p>終わったら後始末。</p>\n\t\t<pre><code class=\"console\">fs: disallow\n% unmount /n/dist\n% unmount /n/sources\n% rm /srv/sources\n% unmount /n/inst</code></pre>\n\t</section>\n</main>\n<aside>\n\t<h1>参考ページ</h1>\n\t<ul>\n\t<li><a href=\"http://p9.nyx.link/replica/\">配布ファイルの更新</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}