{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>Plan 9: さくらVPSにPlan 9をインストール</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"/plan9/doc/inst/index.html\">インストール</a></li>\n\t<li><a href=\"/plan9/doc/guide/index.html\">システムの使い方</a></li>\n\t<li><a href=\"/plan9/doc/devel/index.html\">プログラミング</a></li>\n\t<li><a href=\"/plan9/doc/adm/index.html\">システム管理</a></li>\n\t<li><a href=\"/plan9/man/index.html\">自作ツール集</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2014年2月22日作成</p>\n\t<section>\n\t\t<h1>さくらVPSにPlan 9をインストール</h1>\n\t\t<p>さくらVPSにベル研版Plan 9をインストールしました。\n\t\t最近のさくらVPSはISOインストールが可能になっていますので、\n\t\tそれを使っています。</p>\n\t\t<section>\n\t\t\t<h2>ISOイメージの転送</h2>\n\t\t\t<p>まずはさくらVPSコントロールパネルから、\n\t\t\tISOアップロード用のsftpアカウントを作る必要があります。\n\t\t\tその後、Plan 9公式配布物のISOイメージをダウンロードして、\n\t\t\t(bz2を解凍してから)さくらVPSにアップロードします。</p>\n\t\t\t<p>アップロード用のアカウントは1日で自動的に無効化されるようです。\n\t\t\tまた、アカウントを削除するとアップロードしたISOイメージも消えてまうので、\n\t\t\tやる気のあるときにアップロードすることをおすすめします。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>Plan 9のインストール</h2>\n\t\t\t<p>ISOイメージのアップロードが終わったら、\n\t\t\tコントロールパネルのOS再インストールメニューから、\n\t\t\tISOイメージからインストールを選択します。</p>\n\t\t\t<p>次に、インストール内容確認のところで、virtio有効にチェックが入っているので、\n\t\t\tこれを無効にしてから、インストールを開始します。\n\t\t\t(virtioが有効になっていると<strong>/dev/sdC0</strong>が見つかりませんでした)</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>インストール時の設定</h2>\n\t\t\t<p>以下のようにインストーラからの質問へ答えました。</p>\n\t\t\t<table>\n\t\t\t<tr><th>メニュー</th><th>設定値</th></tr>\n\t\t\t<tr><td>dmaon</td><td>yes</td></tr>\n\t\t\t<tr><td>mouseport</td><td>ps2</td></tr>\n\t\t\t<tr><td>vgasize</td><td>1024x768x32</td></tr>\n\t\t\t<tr><td>monitor</td><td>xga</td></tr>\n\t\t\t</table>\n\t\t\t<p>この後、しばらくするとrioが立ち上がってきます。\n\t\t\tここから先はメニューに答えるだけです。</p>\n\t\t\t<section>\n\t\t\t\t<h3>configfs</h3>\n\t\t\t\t<p>fossil+ventiを選びました。</p>\n\t\t\t</section>\n\t\t\t<section>\n\t\t\t\t<h3>partdisk, prepdisk</h3>\n\t\t\t\t<p>すでにLinux用のパーティションが存在しましたので、\n\t\t\t\tいちど全部を削除してから、作り直しが必要でした。\n\t\t\t\t全部削除してw, qでメニューを抜ければ、\n\t\t\t\tおすすめのパーティションが切られます。</p>\n\t\t\t</section>\n\t\t\t<section>\n\t\t\t\t<h3>fmtfossil</h3>\n\t\t\t\t<p>インストーラが不要だと判断した場合はスキップされますが、\n\t\t\t\t必ず実行しておきましょう。</p>\n\t\t\t</section>\n\t\t\t<section>\n\t\t\t\t<h3>fmtventi</h3>\n\t\t\t\t<p>fmtfossilと同様に、必ずフォーマットしておきましょう。</p>\n\t\t\t</section>\n\t\t\t<section>\n\t\t\t\t<h3>copydist</h3>\n\t\t\t\t<p>ファイルのコピーが始まります。\n\t\t\t\t今回インストールしたときは10分もかかっていない気がします。</p>\n\t\t\t</section>\n\t\t\t<section>\n\t\t\t\t<h3>bootstrap</h3>\n\t\t\t\t<p>Enable boot methodを聞かれたらplan9を選びます。\n\t\t\t\t<a href=\"http://www.tsubame2.org/2010/10/vps-plan-9_11.html\">さくらVPSにまるまるPlan 9をインストール</a>のように、\n\t\t\t\tctl+dで抜ける方法を使っても大丈夫です。</p>\n\t\t\t</section>\n\t\t\t<section>\n\t\t\t\t<h3>finish</h3>\n\t\t\t\t<p>インストールが一通り終わったら、再起動するように促されますが、\n\t\t\t\tその前に、<strong>plan9.ini</strong>へ行の追加が必要です。\n\t\t\t\t適当にウインドウを開いて、</p>\n\t\t\t\t<pre><code class=\"console\">% mount /srv/dos /n/9fat /dev/sdC0/9fat\n% cat /n/9fat/plan9.ini\n# 無ければ、以下の2行を追加\n*nomp=1\nconsole=0 b115200 l8 pn s1\n% unmount /n/9fat</code></pre>\n\t\t\t</section>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>再起動</h2>\n\t\t\t<p>さくらVPSのコントロールパネルから再起動したとき、\n\t\t\tGRUBから先に進まない状態になってしまっていたなら、\n\t\t\tもういちどISOからインストールを選びます。\n\t\t\tそうするとCDからブートしているけれど上記でインストールした\n\t\t\t環境を操作できるようになりますので、\n\t\t\tglendaでログインして以下のコマンドを実行しましょう。</p>\n\t\t\t<pre><code class=\"console\">% disk/mbr -m /386/mbr /dev/sdC0/data</code></pre>\n\t\t\t<p>最初にventiへ書き込みをしているようで、とても重いです。\n\t\t\t少し待てば落ち着きます。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>NICを認識させる</h2>\n\t\t\t<p>インストール直後は、</p>\n\t\t\t<pre><code>igbe: p-&gt;cls 0x0, setting to 0x10\nigbe: bad EEPROM checksum - 0x535E</code></pre>\n\t\t\t<p>のようなエラーでNICが認識できていませんでしたので、<a href=\"https://oraccha.hatenadiary.org/entry/20100928/1285683705\">さくらVPSでPlan 9</a>を参考に\n\t\t\t<strong>/sys/src/9/pc/etherigbe.c</strong>を以下のように変更2しました。</p>\n\t\t\t<pre><code class=\"diff\">--- /sys/src/9/pc/etherigbe.c\n+++ /sys/src/9/pc/etherigbe.c\n-snprint(rop, sizeof(rop), &quot;S :%dDCc;&quot;, bits+3);\n+snprint(rop, sizeof(rop), &quot;CcS :%dDCc;&quot;, bits+3);</code></pre>\n\t\t\t<p>あとはコンパイルして再起動でNICを認識できます。</p>\n\t\t\t<pre><code class=\"console\">% cd /sys/src/9/pc\n% mk 'CONF=pcf'\n% 9fat:\n% mv 9pcf /n/9fat/9pcf\n% mk 'CONF=pcf' nuke\n% fshalt</code></pre>\n\t\t</section>\n\t</section>\n</main>\n<aside>\n\t<h1>関連情報</h1>\n\t<ul>\n\t<li><a href=\"virtio.html\">VirtIOを使う</a></li>\n\t<li><a href=\"sizka.html\">Sizka BASICへのインストール</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}