{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>Plan 9: bloomフィルタ付きventiを作る</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"/plan9/doc/inst/index.html\">インストール</a></li>\n\t<li><a href=\"/plan9/doc/guide/index.html\">システムの使い方</a></li>\n\t<li><a href=\"/plan9/doc/devel/index.html\">プログラミング</a></li>\n\t<li><a href=\"/plan9/doc/adm/index.html\">システム管理</a></li>\n\t<li><a href=\"/plan9/man/index.html\">自作ツール集</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2015年5月4日更新</p>\n\t<section>\n\t\t<h1>bloomフィルタ付きventiを作る</h1>\n\t\t<p>現在の(ベル研が配布している)インストールCDは、\n\t\tventiのbloomフィルタを作成しません。\n\t\tインストールが終わってからbloomフィルタを追加するのは\n\t\tディスクを追加したりと面倒なので、インストール時に作っておきます。</p>\n\t\t<section>\n\t\t\t<h2>インストール中で</h2>\n\t\t\t<p>CDイメージからブートしたら、prepdiskまではそのまま進めます。\n\t\t\tprepdiskまで進んだら、別のwindowを開いてprepdiskを手動実行します。</p>\n\t\t\t<pre><code class=\"console\">% disk/prep -a 9fat -a nvram -a arenas -a isect -a bloom -a fossil -a swap /dev/sdC0/plan9\n% disk/prep -p /dev/sdC0/plan9 &gt;/dev/sdC0/ctl</code></pre>\n\t\t\t<p>終わったらwindowを閉じて、prepdiskを実行しますが、\n\t\t\tprepdiskは終わっているので、そのままqでprepdiskを抜けて次へ進めます。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>初回ブートのあと</h2>\n\t\t\t<p><strong>/dev/swap</strong>の値を以下に設定して、bloomsizeを計算します。</p>\n\t\t\t<pre><code class=\"awk\">#!/usr/bin/awk -f\n\nBEGIN {\n\t# cat /dev/swap\n\tpgsize = 4096 # /dev/swapのpagesize\n\tuserused = 1424 # /dev/swapのuser左側\n\tuserpgs = 458749 # /dev/swapのuser右側\n\n\tuserfree = (userpgs-userused)*pgsize\n\tbloomsize = 2 ^ int(log(userfree/1024/1024*20/100*1/3) / log(2))\n\tprint bloomsize\n}</code></pre>\n\t\t\t<p>上記結果をfmtbloomの-sオプションに与えてフォーマットします。</p>\n\t\t\t<pre><code class=\"console\">% venti/fmtbloom -s 64m /dev/sdC0/bloom</code></pre>\n\t\t\t<p>あとは<strong>venti.conf</strong>にbloomを設定します。</p>\n\t\t\t<pre><code class=\"console\">% venti/conf /dev/sdC0/arenas &gt;/tmp/venti.conf\n(isectとarenasの間あたりに追加)\nbloom /dev/sdC0/bloom\n% venti/conf -w /dev/sdC0/arenas /venti.conf</code></pre>\n\t\t</section>\n\t</section>\n</main>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}