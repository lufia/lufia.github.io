{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>orange/note: Mac OS Xのパッケージ管理</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/notes/index.html\">orange/note</a></li>\n\t<li><a href=\"/notes/pc.html\">PC関連</a></li>\n\t<li><a href=\"/notes/web.html\">web製作</a></li>\n\t<li><a href=\"/notes/sec.html\">セキュリティ</a></li>\n\t<li><a href=\"/notes/hobby.html\">本・ゲーム</a></li>\n\t<li><a href=\"/notes/junk.html\">ジャンク</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2013年8月18日作成</p>\n\t<section>\n\t\t<h1>Mac OS Xのパッケージ管理</h1>\n\t\t<p>Macは、.app形式でアプリケーションを提供しているものと、\n\t\tインストーラ付きの.pkg形式のものがあります。\n\t\t前者は.appをまるっとゴミ箱に捨てればいいのですが、\n\t\t後者の場合、ファイルがいくつかの場所に分散するので簡単ではありません。\n\t\tそういった.pkgの管理について少しメモ。</p>\n\t\t<p class=\"note\">どちらの形式でも、ユーザごとの設定ファイル等は$HOME/Library/以下に\n\t\t作成されている場合があります。探して消しましょう。</p>\n\t\t<section>\n\t\t\t<h2>インストール済みパッケージを調べる</h2>\n\t\t\t<pre><code class=\"console\">$ pkgutil --pkgs</code></pre>\n\t\t\t<p>インストール済みのパッケージIDが表示されます。\n\t\t\tcom.apple.のものがいっぱいあるので、grep -vしておくと便利です。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>パッケージのインストール先を調べる</h2>\n\t\t\t<pre><code class=\"console\">$ pkgutil --info {パッケージID}</code></pre>\n\t\t\t<p>上記コマンドの出力結果から、\n\t\t\tvolumeとlocationを繋げた場所にインストールされています。</p>\n\t\t\t<pre><code>version: 17.0.2004.1119\nvolume: /\nlocation: \ninstall-time: 1358076145</code></pre>\n\t\t\t<p>たとえば、この場合は/直下です。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>パッケージに含まれるファイルを調べる</h2>\n\t\t\t<pre><code class=\"console\">$ pkgutil --files {パッケージID}</code></pre>\n\t\t\t<p>ディレクトリ、ファイルを問わずすべて列挙します。\n\t\t\tたとえば--infoで調べたインストール先が/直下で、--filesの結果が</p>\n\t\t\t<pre><code>Applications\nApplications/Example.app\nApplications/Example.app/file</code></pre>\n\t\t\t<p>であれば、実際のファイルは/Applications/Example.app/fileです。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>パッケージを削除する</h2>\n\t\t\t<p>Lion以前はpkgutil --unlinkが存在していたようですが、\n\t\t\tMountain Lionからは無くなってしまったため、少々面倒です。</p>\n\t\t\t<p>まずは、ファイルを削除します。\n\t\t\t上記で挙げた例の場合、--infoと--filesの結果を組み合わせて、\n\t\t\tExample.appを手動で削除すればいいと思われます。\n\t\t\tただし、ほとんどの場合、/Applicationsは消せないでしょう。\n\t\t\t削除するべきファイルとそうでないファイルを区別するのが少々面倒です。</p>\n\t\t\t<p class=\"note\">Githubに、<a href=\"https://github.com/niw/profiles/blob/master/bin/rm_pkg_files\">rm_pkg_files</a>が\n\t\t\tありましたが、--filesの結果をみて、削除しているだけのようです。</p>\n\t\t\t<p>次に、インストールした情報を削除します。</p>\n\t\t\t<pre><code>sudo pkgutil --forget {パッケージID}</code></pre>\n\t\t\t<p>他のコマンドと異なり、システムに手を入れるのでsudoが必要です。</p>\n\t\t\t<p class=\"note\">Mountain Lionでは、/Library/Receipts/InstallHistory.plistに\n\t\t\tインストール履歴があり、/private/var/db/receipts/以下に\n\t\t\t各種パッケージのbomとplistファイルがありますけれど、\n\t\t\tOSのバージョンによって変更される可能性があるためpkgutilを使え、\n\t\t\tということみたいです。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>削除できないパッケージを削除する</h2>\n\t\t\t<p>pkgutil --forgetで削除すると、以下のようなエラーになる場合があります。</p>\n\t\t\t<pre><code>Unknown error Error Domain=NSCocoaErrorDomain Code=4 &quot;“com.apple.pkg.iPhoto_710.bom” couldn’t be removed.&quot; UserInfo=0x7f97b2673470 {NSFilePath=/var/db/receipts/com.apple.pkg.iPhoto_710.bom, NSUserStringVariant=(\n\tRemove\n), NSUnderlyingError=0x7f97b263ac80 &quot;The operation couldn’t be completed. No such file or directory&quot;}.\nForgot package 'com.apple.pkg.iPhoto_710' on '/'.</code></pre>\n\t\t\t<p>この場合は、/Library/Receipts以下にゴミが残っているだけなので、\n\t\t\t削除したいpkgファイルを上記ディレクトリから手動で消してしまえば問題ありません。</p>\n\t\t</section>\n\t</section>\n</main>\n<aside>\n\t<h1>参考サイト</h1>\n\t<ul>\n\t<li><a href=\"http://blog.niw.at/post/16690761384\">Mac OS Xのパッケージファイルを操作する</a></li>\n\t</ul>\n</aside>\n<aside>\n\t<h1>やっていること</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"http://web.me.com/lufia/alefcompiler/alef/\">Alefコンパイラを読む</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}