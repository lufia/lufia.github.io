{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>orange/note: GitのCombined Diffフォーマット</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/notes/index.html\">orange/note</a></li>\n\t<li><a href=\"/notes/pc.html\">PC関連</a></li>\n\t<li><a href=\"/notes/web.html\">web製作</a></li>\n\t<li><a href=\"/notes/sec.html\">セキュリティ</a></li>\n\t<li><a href=\"/notes/hobby.html\">本・ゲーム</a></li>\n\t<li><a href=\"/notes/junk.html\">ジャンク</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2021年12月4日作成</p>\n\t<section>\n\t\t<h1>GitのCombined Diffフォーマット</h1>\n\t\t<p>通常のコミットに対して</p>\n\t\t<pre><code class=\"console\">% git diff</code></pre>\n\t\t<p>すると、Unified Diffフォーマットで出力されます。\n\t\tこのフォーマットでは左側1文字目の文字をみることで、\n\t\tその行が追加されたのか削除されたのか、を見わけることができます。</p>\n\t\t<pre><code class=\"diff\">diff --git a/sys/src/cmd/auth/factotum/totp.c b/sys/src/cmd/auth/factotum/totp.c\nindex f32caa77..95202886 100644\n--- a/sys/src/cmd/auth/factotum/totp.c\n+++ b/sys/src/cmd/auth/factotum/totp.c\n@@ -50,7 +50,7 @@ base32d(uchar *dest, int ndest, char *src, int nsrc)\n        tab = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&quot;;\n        while(nsrc&gt;=8){\n                for(i = 0; i &lt; 8; i++){\n-                       s = strchr(tab, src[i]);\n+                       s = strchr(tab, toupper(src[i]));\n                        if(s == nil)\n                                return -1;\n                        u[i] = s-tab;</code></pre>\n\t\t<p><em>+</em>の行は追加、<em>-</em>の行は削除、変更のない行はスペースです。</p>\n\t\t<section>\n\t\t\t<h2>マージコミットの場合</h2>\n\t\t\t<p>Gitでマージしたとき、以下の3つが登場します。</p>\n\t\t\t<ol>\n\t\t\t<li>共通の祖先(<em>-1</em>, <em>--base</em>)</li>\n\t\t\t<li>自分たちの差分(<em>-2</em>, <em>--ours</em>)</li>\n\t\t\t<li>相手側(マージするブランチ)の差分(<em>-3</em>, <em>--theirs</em>)</li>\n\t\t\t</ol>\n\t\t\t<p>例えば、</p>\n\t\t\t<pre><code class=\"console\">% git switch main\n% git merge other</code></pre>\n\t\t\t<p>と実行した場合、<em>--base</em>は<strong>main</strong>と<strong>other</strong>の共通にある祖先、\n\t\t\t<em>--ours</em>は<strong>main</strong>の差分、<em>--theirs</em>は<strong>other</strong>の差分となります。</p>\n\t\t\t<p>マージまたはリベース時にコンフリクトが発生したとき、\n\t\t\t通常のdiffとは異なり、左側の先頭2文字で状態を表現するフォーマットが使われます。</p>\n\t\t\t<pre><code class=\"diff\">diff --cc sys/src/ape/lib/ap/plan9/_buf.c\nindex a2dea18c,67f3f9c6..00000000\n--- a/sys/src/ape/lib/ap/plan9/_buf.c\n+++ b/sys/src/ape/lib/ap/plan9/_buf.c\n@@@ -349,7 -348,7 +404,13 @@@ select(int nfds, fd_set *rfds, fd_set *\n        }\n        mux-&gt;selwait = 1;\n        unlock(&amp;mux-&gt;lock);\n++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD\n +      fd = (uintptr_t)_RENDEZVOUS(&amp;mux-&gt;selwait, 0);\n++||||||| 338bd13f\n++      fd = _RENDEZVOUS((uintptr_t)&amp;mux-&gt;selwait, 0);\n++=======\n+       fd = _RENDEZVOUS((unsigned long)&amp;mux-&gt;selwait, 0);\n++&gt;&gt;&gt;&gt;&gt;&gt;&gt; stable\n        if(fd &gt;= 0) {\n                b = _fdinfo[fd].buf;\n                if(FD_ISSET(fd, &amp;mux-&gt;rwant)) {</code></pre>\n\t\t\t<p>このフォーマットはCombined Diffフォーマットといって、\n\t\t\t<em>--ours</em>に含まれる差分は1文字目、<em>--theirs</em>に含まれる差分は2文字目を使って表します。\n\t\t\tまた、どちらにも存在しない(新規の)差分を<em>++</em>で表現します。\n\t\t\t上記例の場合、<em>++</em>となっているのはマージ失敗によりGitが追加した行ですね。</p>\n\t\t\t<p>このコンフリクトを解消してコミットすると、また少し異なる表示になります。</p>\n\t\t\t<pre><code class=\"diff\">diff --cc sys/src/ape/lib/ap/plan9/_buf.c\nindex a2dea18c,67f3f9c6..f6bd186a\n--- a/sys/src/ape/lib/ap/plan9/_buf.c\n+++ b/sys/src/ape/lib/ap/plan9/_buf.c\n@@@ -349,7 -348,7 +348,7 @@@ select(int nfds, fd_set *rfds, fd_set *\n  \t     }\n        mux-&gt;selwait = 1;\n        unlock(&amp;mux-&gt;lock);\n-       fd = (uintptr_t)_RENDEZVOUS(&amp;mux-&gt;selwait, 0);\n -      fd = _RENDEZVOUS((unsigned long)&amp;mux-&gt;selwait, 0);\n++      fd = (int)_RENDEZVOUS(&amp;mux-&gt;selwait, 0);\n        if(fd &gt;= 0) {\n                b = _fdinfo[fd].buf;\n                if(FD_ISSET(fd, &amp;mux-&gt;rwant)) {</code></pre>\n\t\t\t<p>これも同様に、<em>--ours</em>の差分を1文字目、\n\t\t\t<em>--theirs</em>の差分を2文字目を使って表しますが、\n\t\t\t上記のdiffはマージした結果なので、</p>\n\t\t\t<ul>\n\t\t\t<li><em>--ours</em>のブランチにあった行を削除</li>\n\t\t\t<li><em>--theirs</em>のブランチにあった行も削除</li>\n\t\t\t<li>代わりに、<em>++</em>の行を追加</li>\n\t\t\t</ul>\n\t\t\t<p>このように編集すると、現在のブランチ内容と同じになる、という意味です。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>参考</h2>\n\t\t\t<ul>\n\t\t\t<li><a href=\"https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%81%95%E3%81%BE%E3%81%96%E3%81%BE%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB-%E9%AB%98%E5%BA%A6%E3%81%AA%E3%83%9E%E3%83%BC%E3%82%B8%E6%89%8B%E6%B3%95#_combined_diff_%E5%BD%A2%E5%BC%8F\">Git - 高度なマージ手法</a></li>\n\t\t\t</ul>\n\t\t</section>\n\t</section>\n</main>\n<aside>\n\t<h1>やっていること</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"http://web.me.com/lufia/alefcompiler/alef/\">Alefコンパイラを読む</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}