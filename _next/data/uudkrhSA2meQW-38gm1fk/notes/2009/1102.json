{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>orange/note: xpathコマンド</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/notes/index.html\">orange/note</a></li>\n\t<li><a href=\"/notes/pc.html\">PC関連</a></li>\n\t<li><a href=\"/notes/web.html\">web製作</a></li>\n\t<li><a href=\"/notes/sec.html\">セキュリティ</a></li>\n\t<li><a href=\"/notes/hobby.html\">本・ゲーム</a></li>\n\t<li><a href=\"/notes/junk.html\">ジャンク</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2009年11月2日作成</p>\n\t<section>\n\t\t<h1>xpathコマンド</h1>\n\t\t<p>Plan 9に<a href=\"/plan9/doc/devel/python.html\">移植されたPython</a>で、\n\t\tXPath検索するコマンドを作りました。\n\t\t文字コードの関係で4時間ほど悩んだことを除けば、お手軽でいい言語ですね。\n\t\t文字コードの問題については、<a href=\"http://lab.hde.co.jp/2008/08/pythonunicodeencodeerror.html\">PythonのUnicodeEncodeErrorを知る</a>が\n\t\tよくまとまっている資料だと思います。</p>\n\t\t<p>まず、以下のソースをXPath.pyとして保存。</p>\n\t\t<pre><code>#!/bin/python\n\nimport sys, codecs\nfrom BSXPath import BSXPathEvaluator as XPathEvaluator\nfrom BSXPath import XPathResult\n\ndef find(xpath, fin, fname):\n\tlines = fin.readlines()\n\tdata = ''.join(lines)\n\ttry:\n\t\tdoc = XPathEvaluator(data)\n\t\tr = doc.getItemList(xpath)\n\texcept TypeError, e:\n\t\tprint &gt;&gt;sys.stderr, &quot;xpath: '%s' %s&quot; % (fname, e)\n\t\treturn 0\n\texcept ValueError, e:\n\t\tprint &gt;&gt;sys.stderr, &quot;xpath: '%s' %s&quot; % (fname, e)\n\t\treturn 0\n\n\tn = len(r)\n\tfor i in range(n):\n\t\tif isinstance(r[i], unicode):\n\t\t\tprint r[i]\n\t\telif 'decode' not in dir(r[i]):\n\t\t\tprint r[i]\n\t\telse:\n\t\t\tprint r[i].decode('utf-8')\n\treturn n\n\nsys.stdin = codecs.lookup('utf_8')[-1](sys.stdin)\nsys.stdout = codecs.lookup('utf_8')[-1](sys.stdout)\nargv = sys.argv[1:]\nxpath = argv[0]\nargv.pop(0)\n\nfound = 0\nif len(argv) == 0:\n\tfound += find(xpath, sys.stdin, None)\nelse:\n\tfor f in argv:\n\t\tfin = open(f, 'r')\n\t\tfound += find(xpath, fin, f)\n\t\tfin.close()\nif found == 0:\n\texit(1)</code></pre>\n\t\t<p>以下2つのモジュールをXPath.pyと同じ場所に置きます。</p>\n\t\t<ul>\n\t\t<li><a href=\"http://www.crummy.com/software/BeautifulSoup/\">BeautifulSoup.py</a></li>\n\t\t<li><a href=\"http://d.hatena.ne.jp/furyu-tei/20090324\">BSXPath.py</a></li>\n\t\t</ul>\n\t\t<p>最後にxpathを呼び出すシェルスクリプト。</p>\n\t\t<pre><code class=\"sh\">#!/bin/rc\n\nif(~ $#* 0){\n\techo 'usage: xpath pattern [files]' &gt;[1=2]\n\texit usage\n}\n\nexec python /bin/_xpath/XPath.py $*</code></pre>\n\t\t<p>まとめ。</p>\n\t\t<pre><code>/bin/xpath\n/bin/_xpath/BeautifulSoup.py\n/bin/_xpath/BSXPath.py\n/bin/_xpath/XPath.py</code></pre>\n\t</section>\n</main>\n<aside>\n\t<h1>関連情報</h1>\n\t<ul>\n\t<li><a href=\"2008/0214.html\">XPathすごいね</a></li>\n\t</ul>\n</aside>\n<aside>\n\t<h1>やっていること</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"http://web.me.com/lufia/alefcompiler/alef/\">Alefコンパイラを読む</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}