{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>orange/note: VMware ESXiにPlan 9を移行したときのトラブルまとめ</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/notes/index.html\">orange/note</a></li>\n\t<li><a href=\"/notes/pc.html\">PC関連</a></li>\n\t<li><a href=\"/notes/web.html\">web製作</a></li>\n\t<li><a href=\"/notes/sec.html\">セキュリティ</a></li>\n\t<li><a href=\"/notes/hobby.html\">本・ゲーム</a></li>\n\t<li><a href=\"/notes/junk.html\">ジャンク</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2012年10月6日作成</p>\n\t<section>\n\t\t<h1>VMware ESXiにPlan 9を移行したときのトラブルまとめ</h1>\n\t\t<section>\n\t\t\t<h2>cpuサーバからfsをマウントできない</h2>\n\t\t\t<pre><code class=\"console\">% 9fs il!fs.ip.ad.dr!9fs</code></pre>\n\t\t\t<p>こうすると、マウントできず切断されます。\n\t\t\tたぶんカーネルにILを組み込んだけどndb/csに手を入れるのを忘れていたせいだと思う。</p>\n\t\t\t<p class=\"note\">この場合、fsコンソールのflagコマンドでilビットをを立てて、\n\t\t\t出力される接続元と接続先をみるとポートが9になっているのでよくわかる。</p>\n\t\t\t<p>この場合、マウントするには以下のようにポートを数値にすればいいです。</p>\n\t\t\t<pre><code class=\"console\">% 9fs il!fs.ip.ad.dr!17008</code></pre>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>mkextでバックアップを展開すると、not foundが出力される</h2>\n\t\t\t<p>単純に、マウントするとき-cを付けていないだけでした。\n\t\t\tもちろん展開もできていないのでやりなおし。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>ブート時に、version...time...で長時間固まる</h2>\n\t\t\t<p>正確には、version...でしばらく止まって、\n\t\t\ttime...でも止まっていました。トータル20分くらい。\n\t\t\t結局これ、<a href=\"../../plan9/src/il.c\">IPv6対応したil.c</a>のバグで、正しくilrejectできていなくて、\n\t\t\tタイムアウトまで待ち続けていただけっぽいです。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>ipconfigでgbeを使うと、replica時に落ちる</h2>\n\t\t\t<p>gbeというのは、ドライバのことではなくて、ipconfigの引数で</p>\n\t\t\t<pre><code class=\"console\">% ip/ipconfig -g xxx gbe /net/ether0 ...</code></pre>\n\t\t\t<p>とした場合のことです。このとき、replica/pullすると\n\t\t\thungup io connectionとエラーを吐いてシステムごと落ちます。\n\t\t\t調べる気もないので原因不明。gbeではなくetherなら動きました。</p>\n\t\t</section>\n\t\t<section>\n\t\t\t<h2>fs64に含まれるIntel E1000ドライバが遅い</h2>\n\t\t\t<p>もともと含まれていたigbe.cはVMwareのVendorID等を持っていなかったので\n\t\t\tPlan 9カーネルをまねて足したのですが、全然パフォーマンスが出ませんでした。\n\t\t\t具体的には、同じホストにある仮想マシン間でpingを投げる(cpu to fs)と、\n\t\t\t平均30000us程度かかっていました。ふつうは遅くても200us程度なのに。</p>\n\t\t\t<p class=\"note\">不思議なのは、Plan 9カーネルにもigbe.cがあって、\n\t\t\t同じESXiホストに乗っているのに、こっちは200us程度なんですよね。\n\t\t\t様子をみる限りでは、fs側のパケット受信反応が悪い気がする。\n\t\t\tVendorID足したときにミスったかなあ。。。</p>\n\t\t\t<p>結局、<a href=\"../../plan9/src/ether79c970.c\">AMD VlanceドライバをPlan 9カーネルからfsへ移植</a>しました。\n\t\t\tこっちは普通に200us程度の速度出ているみたい。</p>\n\t\t</section>\n\t</section>\n</main>\n<aside>\n\t<h1>やっていること</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"http://web.me.com/lufia/alefcompiler/alef/\">Alefコンパイラを読む</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}