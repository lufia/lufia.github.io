{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>orange/note: Inferno httpdとマルチバイト</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/notes/index.html\">orange/note</a></li>\n\t<li><a href=\"/notes/pc.html\">PC関連</a></li>\n\t<li><a href=\"/notes/web.html\">web製作</a></li>\n\t<li><a href=\"/notes/sec.html\">セキュリティ</a></li>\n\t<li><a href=\"/notes/hobby.html\">本・ゲーム</a></li>\n\t<li><a href=\"/notes/junk.html\">ジャンク</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2011年5月14日更新</p>\n\t<section>\n\t\t<h1>Inferno httpdとマルチバイト</h1>\n\t\t<p class=\"note\">2011年5月14日現在、公式に対応されましたので、\n\t\tこの記事は不要です。</p>\n\t\t<p>Inferno Wikiのための前準備。\n\t\tマルチバイトファイル名を参照すると化けていたので、\n\t\thttpdを2点ほど修正しました。</p>\n\t\t<p>まずは、parse.b:urlunesc。\n\t\t終わりのほうにちょっと追加しただけですね。</p>\n\t\t<pre><code class=\"c\">urlunesc(s : string): string\n{\n\tc, n : int;\n\tu := 0;\n\tbuf := array[2] of byte;\n\tfor(i := 0;i&lt;len s ; i++){\n\t\tc = int s[i];\n\t\tif(c == '%'){\n\t\t\tn = int s[i+1];\n\t\t\tif(n &gt;= '0' &amp;&amp; n &lt;= '9')\n\t\t\t\tn = n - '0';\n\t\t\telse if(n &gt;= 'A' &amp;&amp; n &lt;= 'F')\n\t\t\t\tn = n - 'A' + 10;\n\t\t\telse if(n &gt;= 'a' &amp;&amp; n &lt;= 'f')\n\t\t\t\tn = n - 'a' + 10;\n\t\t\telse\n\t\t\t\tbreak;\n\t\t\tc = n;\n\t\t\tn = int s[i+2];\n\t\t\tif(n &gt;= '0' &amp;&amp; n &lt;= '9')\n\t\t\t\tn = n - '0';\n\t\t\telse if(n &gt;= 'A' &amp;&amp; n &lt;= 'F')\n\t\t\t\tn = n - 'A' + 10;\n\t\t\telse if(n &gt;= 'a' &amp;&amp; n &lt;= 'f')\n\t\t\t\tn = n - 'a' + 10;\n\t\t\telse\n\t\t\t\tbreak;\n\t\t\ti += 2;\n\t\t\tc = c * 16 + n;\n\t\t}\n\t\telse if( c == '+' )\n\t\t\tc = ' ';\n\t\tif(u &gt;= len buf){\n\t\t\tb := array[len buf*2] of byte;\n\t\t\tb[0:] = buf[0:];\n\t\t\tbuf = b;\n\t\t}\n\t\tbuf[u++] = byte c;\n\t}\n\treturn string array of byte buf[0:u];\n}</code></pre>\n\t\t<p>続けてparse.b:urlconv。</p>\n\t\t<pre><code class=\"c\">urlesc(c : int): string\n{\n\ts, t : string;\n\ts[0] = c;\n\tbuf := array of byte s;\n\tfor(i:=0;i&lt;len buf ;i++)\n\t\tt += sys-&gt;sprint(&quot;%%%2.2x&quot;, int buf[i]);\n\treturn t;\n}\n\nurlconv(p : string): string\n{\n\tc : int;\n\tt : string;\n\tfor(i:=0;i&lt;len p ;i++){\n\t\tc = p[i];\n\t\tif(c == 0)\n\t\t\tbreak;\n\t\tif(c &lt;= ' ' || c == '%' || c &gt;= Runeself){\n\t\t\tt += urlesc(c);\n\t\t} else {\n\t\t\tt[len t] = c;\n\t\t}\n\t}\n\treturn t; \n}</code></pre>\n\t\t<p>あとはふつうに。</p>\n\t\t<pre><code class=\"console\">% mk &amp;&amp; mk install</code></pre>\n\t\t<p class=\"note\">svc/httpdに-Dオプションを与えると、/services/httpd以下に\n\t\t詳細なログを書き出します。問題解決にとても役立ちます。</p>\n\t</section>\n</main>\n<aside>\n\t<h1>やっていること</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"http://web.me.com/lufia/alefcompiler/alef/\">Alefコンパイラを読む</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}