{"pageProps":{"html":"<!doctype html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\">\n<title>orange/note: ffmpegでHTTPリクエストにヘッダを追加する</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<meta name=\"author\" content=\"http://www.hatena.ne.jp/lufiabb/\">\n</head>\n<body>\n<nav>\n\t<h1>メニュー</h1>\n\t<ul>\n\t<li><a href=\"/notes/index.html\">orange/note</a></li>\n\t<li><a href=\"/notes/pc.html\">PC関連</a></li>\n\t<li><a href=\"/notes/web.html\">web製作</a></li>\n\t<li><a href=\"/notes/sec.html\">セキュリティ</a></li>\n\t<li><a href=\"/notes/hobby.html\">本・ゲーム</a></li>\n\t<li><a href=\"/notes/junk.html\">ジャンク</a></li>\n\t</ul>\n</nav>\n<main>\n\t<p class=\"revision\">2022年6月7日作成</p>\n\t<section>\n\t\t<h1>ffmpegでHTTPリクエストにヘッダを追加する</h1>\n\t\t<p>HLSをダウンロードする際に、<em>ffmpeg</em>にHTTPヘッダを指定したいことがある。\n\t\tその場合、<em>ffmpeg</em>には<em>-headers</em>オプションがあるので、これを使うとよい。</p>\n\t\t<pre><code class=\"console\">$ ffmpeg -headers 'User-Agent: xx' -i 'https://example.com/movie.m3u8?q=xx' ...\n\n# User-Agent*の場合は`-user_agent`オプションが特別に用意されているので、\n# これで代用してもよい\n$ ffmpeg -user_agent 'xx' -i 'https://example.com/movie.m3u8?q=xx'</code></pre>\n\t\t<p>ここで、複数ヘッダを指定したい場合は、<em>-headers</em>オプションの値をCRLFで区切って与えるらしい。</p>\n\t\t<pre><code class=\"console\">$ ffmpeg -headers $'User-Agent: xx\\r\\nAuth-Token: xx\\r\\n' -i ...</code></pre>\n\t\t<p>ところで、<em>-headers</em>オプションと<em>-i</em>オプションを逆にすると、\n\t\t実際のリクエストにヘッダが反映されない。</p>\n\t\t<pre><code class=\"console\">$ ffmpeg -i ... -headers ... # これは期待通りに動かない</code></pre>\n\t\t<p>この理由は、<em>ffmpeg</em>には<a href=\"https://trac.ffmpeg.org/wiki/Concatenate\">concatフィルタ</a>など、\n\t\t複数ストリームを扱うフィルタがあって、このとき複数の<em>-i</em>オプションを\n\t\t与えることで一時ファイルを経由せずストリームを結合できるようになっている。\n\t\tそのため、<em>-headers</em>のようなオプション(マニュアルによるとinfile options)は、\n\t\t「次に出現する<em>-i</em>オプション」に対して反映される。\n\t\t上記のコマンドでは、<em>-i</em>オプションの前には<em>-headers</em>がないので\n\t\tデフォルトのヘッダでURLにリクエストするし、\n\t\tまた、<em>-headers</em>オプションの後に<em>-i</em>オプションがないのでこれは単に無視される。</p>\n\t\t<p>実際にどのようなリクエストを送っているかは<em>-loglevel</em>オプションで確認できる。</p>\n\t\t<pre><code class=\"console\">$ ffmpeg -loglevel debug ...</code></pre>\n\t</section>\n</main>\n<aside>\n\t<ul>\n\t<li><a href=\"https://superuser.com/questions/1656570/packet-corruption-during-download-then-ffmpeg-hangs\">Packet corruption during download, then ffmpeg hangs</a></li>\n\t</ul>\n</aside>\n<aside>\n\t<h1>やっていること</h1>\n\t<ul>\n\t<li><a href=\"/plan9/index.html\">Plan 9</a></li>\n\t<li><a href=\"http://web.me.com/lufia/alefcompiler/alef/\">Alefコンパイラを読む</a></li>\n\t</ul>\n</aside>\n<footer>\n\t<p>見れない、表示がおかしい場合は、動作環境を添えて<a href=\"mailto:webmaster@lufia.org\">webmaster@lufia.org</a>まで連絡ください。</p>\n</footer>\n</body>\n</html>\n"},"__N_SSG":true}